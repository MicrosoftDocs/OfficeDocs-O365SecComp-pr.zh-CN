---
title: 配置反恶意软件策略
ms.author: tracyp
author: MSFTTracyp
manager: dansimp
ms.date: 3/17/2016
audience: ITPro
ms.topic: article
ms.service: O365-seccomp
localization_priority: Normal
search.appverid:
- MET150
ms.assetid: b0cfc21f-e3c6-41b6-8670-feb2b2e252e5
ms.collection:
- M365-security-compliance
description: 通过默认反恶意软件策略自动启用全公司的恶意软件筛选。
ms.openlocfilehash: 474f762fe0710b7c7032ec99b353c9d5c20b7f3b
ms.sourcegitcommit: 769b506c828c475c713dbb337e115714dcc7f17c
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 08/31/2019
ms.locfileid: "36699297"
---
# <a name="configure-anti-malware-policies"></a>配置反恶意软件策略

 通过默认反恶意软件策略自动启用全公司的恶意软件筛选。作为管理员，您可以查看和编辑，但不能删除默认反恶意软件策略，以最适合贵组织的需求。更精确地讲，您还可以创建自定义恶意软件筛选策略，并将其应用到组织中的特定用户、组或域。自定义策略的优先级通常高于默认策略，但您可以更改自定义策略的优先级（运行顺序）。

以下视频显示在本主题中详细描述的反恶意软件策略的一些配置步骤：

> [!VIDEO https://www.microsoft.com/videoplayer/embed/12517702-ab48-4df8-a7ff-8eb02aa31724?autoplay=false]

有关反恶意软件策略的详细信息, 请参阅[反恶意软件保护](anti-malware-protection.md)。

## <a name="what-do-you-need-to-know-before-you-begin"></a>开始前，有必要了解什么？

- 若要打开 Exchange 管理中心 (EAC), 请参阅 exchange [online 中的 exchange 管理中心](https://docs.microsoft.com/Exchange/exchange-admin-center)或 Exchange [online Protection 中的 exchange 管理中心](exchange-admin-center-in-exchange-online-protection-eop.md)。

- 若要连接到 Exchange Online PowerShell，请参阅[连接到 Exchange Online PowerShell](https://go.microsoft.com/fwlink/p/?linkid=396554)。 若要连接到 Exchange Online Protection PowerShell, 请参阅[连接到 Exchange Online Protection powershell](https://go.microsoft.com/fwlink/p/?linkid=627290)。

- 您必须先获得权限，然后才能执行此过程或多个过程。 若要查看所需的权限, 请参阅 EOP 主题中的 " [Exchange Online 中的功能权限](http://technet.microsoft.com/library/15073ce1-0917-403b-8839-02a2ebc96e16.aspx)" 或 "[功能权限](eop/feature-permissions-in-eop.md)" 主题中的 "反恶意软件" 条目。

- 有关可能适用于本主题中的过程的键盘快捷方式的信息, 请参阅 exchange [Online 中 exchange 管理中心的键盘快捷方式](https://docs.microsoft.com/Exchange/accessibility/keyboard-shortcuts-in-admin-center)。

## <a name="use-the-eac-to-create-anti-malware-policies"></a>使用 EAC 创建反恶意软件策略

在 EAC 中创建自定义反恶意软件策略将同时为两者创建恶意软件筛选器规则和关联的恶意软件筛选器策略。

1. 在 EAC 中, 转到 "**保护** \> **恶意软件筛选器**", **** ![然后单击 "](media/ITPro-EAC-AddIcon.png)新建添加图标"。

2. 在打开的 "**新建反恶意软件策略**" 页中, 配置以下设置:

   - **名称**: 输入策略的唯一描述性名称。

   - **说明**: 输入策略的可选说明。

   - **恶意软件检测响应**: 为**要通知收件人的邮件是否已被隔离**, 请选择以下值之一？设置:

     - **No**: 阻止将整个邮件 (包括附件) 传递给预期收件人。 所有者、作者和网站所有者仍可以访问此项目。

     - **是并使用默认通知文本: 将**所有邮件附件 (不仅仅是检测到的文件) 替换为包含此默认文本的文本文件:

       > 在此电子邮件中包含的一个或多个附件中检测到恶意软件。 所有附件都已被删除。

     - **是并使用自定义通知文本**: 将所有邮件附件 (不仅仅是检测到的文件) 替换为包含您在**自定义警报文本框**中指定的自定义文本的文本文件。

     > [!NOTE]
     > 如果在入站或出站邮件的**邮件正文**中检测到恶意软件, 将删除整个邮件, 而不考虑为**恶意软件检测响应**配置的设置。

   - **通知**: 当恶意软件筛选删除邮件时, 此部分中的设置将控制通知。 这些设置不适用于所有附件都被默认或自定义通知文本替换的邮件。

     - **发件人通知**: 选择以下选项中的一个或两个:

       - **通知内部发件**人: 内部发件人位于组织内部。

       - **通知外部发件**人: 外部发件人位于组织外部。

     - **管理员通知**: 选择以下选项中的一个或两个:

       - 向**管理员通知来自内部发件人的未送达邮件**: 如果选择此选项, 请在 "**管理员电子邮件地址**" 字段中输入通知电子邮件地址。

       - 向**管理员通知来自外部发件人的未送达邮件**: 如果选择此选项, 请在 "**管理员电子邮件地址**" 字段中输入通知电子邮件地址。

     - **自定义通知**: 这些设置将替换用于发件人或管理员的默认通知文本。 有关默认值的详细信息, 请参阅[反恶意软件策略](anti-malware-protection.md#anti-malware-policies)。

       - **使用自定义通知文本**: 如果选择此选项, 则需要使用 "发件人**姓名**" 和 "发件人**地址**" 字段, 以指定在自定义通知邮件中使用的发件人姓名和电子邮件。

       - **来自内部发件人的邮件**: 如果您选择从内部发件人通知发件人或管理员有关无法传递的邮件, 则需要使用**主题**和**邮件**字段来指定的主题和邮件正文。自定义通知消息。

       - **来自外部发件人的邮件**: 如果您选择将来自外部发件人的未送达邮件通知给发件人或管理员, 则需要使用**subject**和**message**字段指定的主题和邮件正文。自定义通知消息。

   - **应用**于: 此部分中的设置标识应用该策略的内部收件人。

     - **如果**: 单击 "**选择一个**" 下拉下拉箭头, 然后选择规则的 "条件":

       - **收件人为**: 指定组织中的一个或多个邮箱、邮件用户或邮件联系人。 在出现的 "**选择成员**" 对话框中, 从列表中选择一个或多个收件人, 然后单击 "**加载项\>**"。 在 "**检查名称**" 字段中, 可以对多个电子邮件地址使用通配符 ( \*例如: @fabrikam)。 完成后, 请单击 **"确定"**。

       - **收件人域为**: 在 Office 365 中的一个或多个已配置的接受域中指定收件人。 在出现的对话框中, 选择一个或多个域, 然后单击 "**外接\>程序**"。 完成后, 请单击 **"确定"**。

       - **收件人是的成员**: 指定组织中的一个或多个组。 在出现的 "**选择成员**" 对话框中, 从列表中选择一个或多个组, 然后单击 "**外接程序\>**"。 完成后, 请单击 **"确定"**。

     一次只能使用一种条件, 但可以为条件指定多个值。 若要添加更多条件, 请单击 "**添加条件**", 然后从剩余选项中进行选择。

     - **除了**: 若要为规则添加例外, 请单击 "**添加例外**", 单击 "**选择一个**下拉", 并为规则配置例外。 设置和行为与条件完全一样。

3. 完成后，单击“保存”****。

## <a name="use-the-eac-to-view-anti-malware-policies"></a>使用 EAC 查看反恶意软件策略

1. 在 EAC 中, 转到 "**保护** \> " "**恶意软件筛选器**"。

2. 选择策略时, 有关该策略的信息将显示在详细信息窗格中。 若要查看有关策略的详细信息, **** ![请单击 "](media/ITPro-EAC-EditIcon.png)编辑编辑图标"。

   - "**已启用**" 属性值、"**优先级**" 属性值和 "**应用于**" 选项卡上的设置位于恶意软件筛选器规则中。

   - "**常规**" 和 "**设置**" 选项卡上的设置位于恶意软件筛选器策略中。

## <a name="use-the-eac-to-modify-an-anti-malware-policy"></a>使用 EAC 修改反恶意软件策略

1. 在 EAC 中, 转到 "**保护** \> " "**恶意软件筛选器**"。

2. 选择该策略, 然后单击 "**编辑** ![编辑图标](media/ITPro-EAC-EditIcon.png)"。 有关这些设置的信息, 请参阅本主题中的[使用 EAC 创建反恶意软件策略](#use-the-eac-to-create-anti-malware-policies)部分。

   **注意**：

   - 除了在一页上的所有内容, 这些设置将在 "**常规**"、"**设置**" 和 "**应用于**" 选项卡之间划分。 "**应用于**" 选项卡在名为 "默认" 的默认策略中不可用。

   - 您不能重命名默认策略。

## <a name="use-the-eac-to-enable-or-disable-an-anti-malware-policy"></a>使用 EAC 启用或禁用反恶意软件策略

1. 在 EAC 中, 转到 "**保护** \> " "**恶意软件筛选器**"。

2. 从列表中选择策略, 然后配置下列设置之一:

   - **禁用策略**: 清除 "**已启用**" 列中的复选框。 默认情况下, 当您在 EAC 中创建反恶意软件策略时, 将会启用这些策略。

   - **启用策略**: 选中 "**已启用**" 列中的复选框。

## <a name="use-the-eac-to-set-the-priority-of-custom-anti-malware-policies"></a>使用 EAC 设置自定义反恶意软件策略的优先级

默认情况下, 将根据反恶意软件策略的创建顺序为其指定优先级 (更新的策略的优先级低于旧策略)。 优先级越低, 策略的优先级越高, 策略的处理优先级就越高 (优先级较高的策略在优先级较低的策略之前处理)。 任何两个策略都不能具有相同的优先级。

 **注意**：

- 在 EAC 中, 您只能在创建反恶意软件策略后更改其优先级。 在 PowerShell 中, 您可以在创建恶意软件筛选器规则 (可能会影响现有规则的优先级) 时替代默认优先级。

- 在 EAC 中, 反恶意软件策略的处理顺序为它们的显示顺序 (第一个策略的**优先级**值为 0)。 默认的反恶意软件策略的优先级值为最低, 无法进行更改。

若要更改策略的优先级, 请在列表中向上或向下移动策略 (不能直接修改 EAC 中的**优先级**号码)。

1. 在 EAC 中, 转到 "**保护** \> " "**恶意软件筛选器**"。

2. 选择一个策略, 然后单击 "**上** ![移" 箭头图标](media/ITPro-EAC-UpArrowIcon.png)或**** !["下移" 箭头图标](media/ITPro-EAC-DownArrowIcon.png) , 在列表中向上或向下移动该规则。

## <a name="use-the-eac-to-remove-anti-malware-policies"></a>使用 EAC 删除反恶意软件策略

当您使用 EAC 删除反恶意软件策略时, 恶意软件筛选器规则和相应的恶意软件筛选器策略都将被删除。

1. 在 EAC 中, 转到 "**保护** \> " "**恶意软件筛选器**"。

2. 选择要从列表中删除的反恶意软件策略, 然后单击 "**删除** ![删除图标](media/ITPro-EAC-DeleteIcon.png)"。

## <a name="use-exchange-online-powershell-or-exchange-online-protection-powershell-to-configure-anti-malware-policies"></a>使用 Exchange Online PowerShell 或 Exchange Online Protection PowerShell 配置反恶意软件策略

### <a name="use-powershell-to-create-anti-malware-policies"></a>使用 PowerShell 创建反恶意软件策略

在 PowerShell 中创建反恶意软件策略的过程分为两个步骤:

1. 创建恶意软件筛选器策略。

2. 创建用于指定应用规则的恶意软件筛选器策略的恶意软件筛选器规则。

 **注意**：

- 您可以创建新的恶意软件筛选器规则, 并向其分配现有的未关联的恶意软件筛选器策略。 恶意软件筛选器规则不能与多个恶意软件筛选器策略相关联。

- 在创建策略之前, 您可以在 PowerShell 中的新反恶意软件策略中配置以下两个设置:

  - 将新策略创建为禁用 (在**get-malwarefilterpolicy** cmdlet 上_启用_ `$false` )。

  - 在**enable-malwarefilterrule** cmdlet 上创建 (_优先级_ _ \<编号\>_) 过程中设置策略的优先级。

- 您在 PowerShell 中创建的恶意软件筛选器策略不会显示在 EAC 中, 除非您将恶意软件筛选器策略分配给恶意软件筛选器规则。

#### <a name="step-1-use-powershell-to-create-a-malware-filter-policy"></a>步骤 1: 使用 PowerShell 创建恶意软件筛选器策略

若要创建恶意软件筛选器策略, 请使用以下语法:

```PowerShell
New-MalwareFilterPolicy -Name "<PolicyName>" [-Action <DeleteMessage | DeleteAttachmentAndUseDefaultAlert | DeleteAttachmentAndUseCustomAlert>] [-AdminDisplayName "<OptionalComments>"] [-BypassInboundMessages <$true | $false>] [-BypassOutboundMessages <$true | $false>] [-CustomNotifications <$true | $false>] [<Inbound notification options>] [<Outbound notification options>]
```

此示例使用以下设置创建名为 Contoso 恶意软件筛选器策略的新恶意软件筛选器策略:

- 阻止包含恶意软件的邮件 (我们不使用_Action_参数, 默认值为`DeleteMessage`)。

- 在邮件中检测到恶意软件时, 请勿通知邮件发件人 (我们未使用_EnableExternalSenderNotifications_或_EnableInternalSenderNotifications_参数, 并且两者都是`$false`默认值)。

- 当在内部发件人发送的邮件中检测到恶意软件时通知管理员 admin@contoso.com。

```PowerShell
New-MalwareFilterPolicy -Name "Contoso Malware Filter Policy" -EnableInternalSenderAdminNotifications $true -InternalSenderAdminAddress admin@contoso.com
```

有关语法和参数的详细信息, 请参阅[get-malwarefilterpolicy](http://technet.microsoft.com/library/3f2cf682-e2c9-41e3-8f30-88f6cccf7c57.aspx)。

#### <a name="step-2-use-powershell-to-create-a-malware-filter-rule"></a>步骤 2: 使用 PowerShell 创建恶意软件筛选器规则

若要创建恶意软件筛选器规则, 请使用以下语法:

```PowerShell
New-MalwareFilterRule -Name "<RuleName>" -MalwareFilterPolicy "<PolicyName>" <Recipient filters> [<Recipient filter exceptions>] [-Comments "<OptionalComments>"]
```

本示例使用以下设置创建名为 Contoso 收件人的新的恶意软件筛选器规则:

- 名为 Contoso 恶意软件筛选器策略的恶意软件筛选器策略与规则相关联。

- 该规则适用于 contoso.com 域中的收件人。

```PowerShell
New-MalwareFilterRule -Name "Contoso Recipients" -MalwareFilterPolicy "Contoso Malware Filter Policy" -RecipientDomainIs contoso.com
```

有关语法和参数的详细信息, 请参阅[enable-malwarefilterrule](http://technet.microsoft.com/library/6097959b-7504-48b2-b8ef-c1237b29a94a.aspx)。

### <a name="use-powershell-to-view-malware-filter-policies"></a>使用 PowerShell 查看恶意软件筛选器策略

若要返回所有恶意软件筛选器策略的摘要列表, 请运行以下命令:

```PowerShell
Get-MalwareFilterPolicy
```

若要返回有关特定恶意软件筛选器策略的详细信息, 请使用以下语法:

```PowerShell
Get-MalwareFilterPolicy -Identity "<PolicyName>" | Format-List [<Specific properties to view>]
```

本示例将返回名为 "主管" 的恶意软件筛选器策略的所有属性值。

```PowerShell
Get-MalwareFilterPolicy -Identity "Executives" | Format-List
```

本示例仅返回相同策略的指定属性。

```PowerShell
Get-MalwareFilterPolicy -Identity "Executives" | Format-List Action,AdminDisplayName,CustomNotifications,Enable*Notifications
```

有关语法和参数的详细信息, 请参阅[get-malwarefilterpolicy](http://technet.microsoft.com/library/560a6958-c940-4c26-9a54-3f78965df32a.aspx)。

### <a name="use-powershell-to-view-malware-filter-rules"></a>使用 PowerShell 查看恶意软件筛选器规则

若要返回所有恶意软件筛选器规则的摘要列表, 请运行以下命令:

```PowerShell
Get-MalwareFilterRule
```

若要返回有关特定恶意软件筛选器规则的详细信息, 请使用以下语法:

```PowerShell
Get-MalwareFilterRule -Identity "<RuleName>" | Format-List [<Specific properties to view>]
```

本示例将返回名为 "主管" 的恶意软件筛选器规则的所有属性值。

```PowerShell
Get-MalwareFilterRule -Identity "Executives" | Format-List
```

下面的示例仅返回同一规则的指定属性。

```PowerShell
Get-MalwareFilterRule -Identity "Executives" | Format-List Name,Priority,State,MalwareFilterPolicy,*Is,*SentTo,*MemberOf
```

有关语法和参数的详细信息, 请参阅[enable-malwarefilterrule](http://technet.microsoft.com/library/7036d1ac-e9ef-437d-9035-79449e6572d6.aspx)。

### <a name="use-powershell-to-modify-a-malware-filter-policy"></a>使用 PowerShell 修改恶意软件筛选器策略

修改 PowerShell 中的恶意软件策略时, 没有其他设置可用。 它们与创建策略时可用的设置相同。 请注意, 不能重命名默认策略。

若要修改恶意软件筛选器策略, 请使用以下语法:

```PowerShell
Set-MalwareFilterPolicy -Identity "<PolicyName>" <Settings>
```

有关语法和参数的详细信息, 请参阅[get-malwarefilterpolicy](http://technet.microsoft.com/library/52d1ecdd-56fc-456a-8de7-4b31521ce2a5.aspx)。

### <a name="use-powershell-to-modify-a-malware-filter-rule"></a>使用 PowerShell 修改恶意软件筛选器规则

修改 PowerShell 中的恶意软件筛选器规则时, 不能禁用或启用该规则 ( **enable-malwarefilterrule** cmdlet 中没有_已启用_的参数)。 而是使用**enable-malwarefilterrule**和**enable-malwarefilterrule** cmdlet, 如下一节中所述。

若要修改恶意软件筛选器规则, 请使用以下语法:

```PowerShell
Set-MalwareFilterRule -Identity "<RuleName>" <Settings>
```

有关语法和参数的详细信息, 请参阅[enable-malwarefilterrule](http://technet.microsoft.com/library/f5d6be2b-25c4-427a-9d09-6ed55858c891.aspx)。

### <a name="use-powershell-to-enable-or-disable-malware-filter-rules"></a>使用 PowerShell 启用或禁用恶意软件筛选器规则

默认情况下, 在 PowerShell 中创建反恶意软件策略时, 将启用这些策略, 但您可以使用 PowerShell 创建已禁用的恶意软件筛选器规则 (使用**enable-malwarefilterrule** cmdlet __ 和值`$false`的 enabled 参数)。

若要在 PowerShell 中启用或禁用恶意软件筛选器规则, 请使用以下语法:

```PowerShell
<Enable-MalwareFilterRule | Disable-MalwareFilterRule> -Identity "<RuleName>"
```

本示例禁用名为 "Marketing 部门" 的恶意软件筛选器规则。

```PowerShell
Disable-MalwareFilterRule -Identity "Marketing Department"
```

本示例启用相同的规则。

```PowerShell
Enable-MalwareFilterRule -Identity "Marketing"
```

有关语法和参数的详细信息, 请参阅[Enable-enable-malwarefilterrule](http://technet.microsoft.com/library/1310fac0-7451-4b74-bca2-3398d6dd1e73.aspx)和[Disable-enable-malwarefilterrule](http://technet.microsoft.com/library/83376568-d37f-41b7-aea3-bd08333ce07e.aspx)。


### <a name="use-powershell-to-set-the-priority-of-custom-malware-filter-rules"></a>使用 PowerShell 设置自定义恶意软件筛选器规则的优先级

可以设置的规则最高优先级值是 0。可以设置的最小优先级值取决于规则的数量。例如，如果有五个规则，则可以使用的优先级值为 0 到 4。更改现有规则的优先级可对其他规则产生级联效应。例如，假设有五个规则（优先级为 0 到 4），如果将某个规则的优先级更改为 2，则优先级为 2 的现有规则将更改为优先级 3，优先级为 3 的规则将更改为优先级 4。

若要在 PowerShell 中设置自定义恶意软件筛选器规则的优先级, 请使用以下语法:

```PowerShell
Set-MalwareFilterRule -Identity "<RuleName>" -Priority <Number>
```

本示例将名为 "市场部" 的规则的优先级设置为2。 所有优先级均小于或等于2的现有规则将减 1 (其优先级数增加 1)。

```PowerShell
Set-MalwareFilterRule -Identity "Marketing Department" -Priority 2
```

 **注意**: 若要在创建时设置新规则的优先级, 请使用**enable-malwarefilterrule** cmdlet 上的_priority_参数。

### <a name="use-powershell-to-remove-malware-filter-policies"></a>使用 PowerShell 删除恶意软件筛选器策略

当您使用 PowerShell 删除恶意软件筛选器策略时, 不会删除相应的恶意软件筛选器规则。

若要删除 PowerShell 中的恶意软件筛选器策略, 请使用以下语法:

```PowerShell
Remove-MalwareFilterPolicy -Identity "<PolicyName>"
```

本示例将删除名为 "Marketing 部门" 的恶意软件筛选器策略。

```PowerShell
Remove-MalwareFilterPolicy -Identity "Marketing Department"
```

有关语法和参数的详细信息, 请参阅[get-malwarefilterpolicy](http://technet.microsoft.com/library/cfc57936-1cc6-44dc-90c8-d77f37ea2661.aspx)。

## <a name="how-do-you-know-these-procedures-worked"></a>您如何知道这些过程工作正常？

以下步骤提供使用 EICAR.TXT 防病毒测试文件的说明，以验证恶意软件筛选功能是否能正常工作。使用不阻止文件的电子邮件客户端。

> [!IMPORTANT]
> EICAR.TXT 文件不是病毒。但是，由于用户通常需要测试该安装是否能正常工作，防病毒行业通过欧洲反计算机病毒协会采用了 EICAR 标准来满足该需求。

### <a name="use-the-eicartxt-file-to-verify-malware-filtering-functionality"></a>使用 EICAR.TXT 文件，以验证恶意软件筛选功能

1. 创建一个新的文本文件，然后将文件命名为 EICAR.TXT。

2. 将以下行复制到文本文件中：

   ```PowerShell
   X5O!P%@AP[4\PZX54(P^)7CC)7}$EICAR-STANDARD-ANTIVIRUS-TEST-FILE!$H+H*
   ```

   请确保此为文件中的唯一字符串。完成后，您将有 68 个字节的文件。

   如果使用台式机防病毒程序，务必使保存文件的文件夹排除在扫描范围外。

3. 将该文件附加至将通过服务筛选的电子邮件。

   检查测试邮件的收件人邮箱。根据您配置的恶意软件检测响应，将删除整个邮件，或者将删除附件，并用警告文本文件替换。此外还将分发任何已配置的通知。

   收件人可能会收到类似于以下内容的通知消息 (如果已配置): "此邮件由邮件传递软件自动创建。 由于检测到恶意软件, 你的电子邮件未传递给目标收件人。 此外, 还将包括以下附加信息: 邮件的主题、邮件的发件人邮件收到邮件的时间、邮件 ID (也称为客户端 ID) 在邮件的邮件头中找到。使用 "邮件 ID: 令牌", 并找到检测到的 (将为 eicar.txt)。

4. 在完成测试后删除 EICAR.TXT 文件，从而其他用户就不会收到不必要的警报。

## <a name="for-more-information"></a>详细信息

[反恶意软件保护](anti-malware-protection.md)

[反恶意软件保护常见问题解答](anti-malware-protection-faq-eop.md)
