---
title: Office 365 Exchange Online 数据删除
ms.author: robmazz
author: robmazz
manager: laurawi
ms.date: 8/21/2018
audience: ITPro
ms.topic: article
ms.service: Office 365 Administration
localization_priority: None
search.appverid:
- MET150
ms.collection: Strat_O365_Enterprise
description: 如何柔和及硬 Exchange Online 中处理数据删除。
ms.openlocfilehash: 3a17b09e9c21ae309e00bcb0ddc0b51b93478bc1
ms.sourcegitcommit: 36c5466056cdef6ad2a8d9372f2bc009a30892bb
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 08/27/2018
ms.locfileid: "22525255"
---
# <a name="exchange-online-data-deletion-in-office-365"></a><span data-ttu-id="b81b6-103">Office 365 中的 Exchange Online 数据删除</span><span class="sxs-lookup"><span data-stu-id="b81b6-103">Exchange Online Data Deletion in Office 365</span></span>
<span data-ttu-id="b81b6-p101">在 Exchange Online 中，有两种类型的删除： 软删除和硬删除。这适用于邮箱和邮箱内的项目。</span><span class="sxs-lookup"><span data-stu-id="b81b6-p101">Within Exchange Online, there are two kinds of deletions: soft deletions and hard deletions. This applies to both mailboxes and items within a mailbox.</span></span>

## <a name="soft-deleted-and-hard-deleted-mailboxes"></a><span data-ttu-id="b81b6-106">软删除和硬删除邮箱</span><span class="sxs-lookup"><span data-stu-id="b81b6-106">Soft-Deleted and Hard-Deleted Mailboxes</span></span>
<span data-ttu-id="b81b6-p102">软删除用户邮箱的邮箱已使用 Office 365 管理中心或 Remove-mailbox cmdlet 被删除，仍已在 Azure Active Directory 回收站小于 30 天。邮箱可能会变得软删除任何通过以下方式：</span><span class="sxs-lookup"><span data-stu-id="b81b6-p102">A soft-deleted user mailbox is a mailbox that has been deleted using the Office 365 admin center or the Remove-Mailbox cmdlet and has still been in the Azure Active Directory recycle bin for less than 30 days. A mailbox can become soft-deleted in any of the following ways:</span></span>
- <span data-ttu-id="b81b6-109">用户邮箱关联的 Azure Active Directory 用户帐户是软删除 （超出范围或 recycle bin 容器中为用户对象）。</span><span class="sxs-lookup"><span data-stu-id="b81b6-109">The user mailbox's associated Azure Active Directory user account is soft-deleted (the user object is out of scope or in the recycle bin container).</span></span>
- <span data-ttu-id="b81b6-110">已硬删除的用户邮箱关联的 Azure Active Directory 用户帐户但 Exchange Online 邮箱处于诉讼保留或电子数据展示保留。</span><span class="sxs-lookup"><span data-stu-id="b81b6-110">The user mailbox's associated Azure Active Directory user account has been hard-deleted but the Exchange Online mailbox is under a litigation hold or eDiscovery hold.</span></span>
- <span data-ttu-id="b81b6-111">用户邮箱的相关联的 Azure Active Directory 用户帐户已清除内最近 30 天;这是 Exchange Online 的保留的最大长度将保留邮箱中的软删除状态之前永久清除且不可恢复。</span><span class="sxs-lookup"><span data-stu-id="b81b6-111">The user mailbox's associated Azure Active Directory user account has been purged within the last 30 days; which is the maximum retention length Exchange Online will keep the mailbox in a soft-deleted state before it is permanently purged and unrecoverable.</span></span>

<span data-ttu-id="b81b6-112">硬删除用户邮箱是邮箱已删除的以下方法之一：</span><span class="sxs-lookup"><span data-stu-id="b81b6-112">A hard-deleted user mailbox is a mailbox that has been deleted in one of the following ways:</span></span>
- <span data-ttu-id="b81b6-p103">用户邮箱已软删除超过 30 天，并且关联的 Azure Active Directory 用户已硬删除。被永久删除所有邮箱内容，如电子邮件、 联系人和文件。</span><span class="sxs-lookup"><span data-stu-id="b81b6-p103">The user mailbox has been soft-deleted for more than 30 days, and the associated Azure Active Directory user has been hard-deleted. All mailbox content such as emails, contacts and files are permanently deleted.</span></span>
- <span data-ttu-id="b81b6-p104">与用户邮箱关联的用户帐户已硬删除在 Azure Active Directory 中。用户邮箱目前软删除 Exchange Online 中，并且将停留在软删除状态 30 天。如果在 30 天内的新的 Azure Active Directory 用户同步从原始收件人帐户需要具有相同的**ExchangeGuid**或**ArchiveGuid**，并且新帐户授权的 Exchange Online，这将导致的硬删除原始的用户邮箱。被永久删除所有邮箱内容，如电子邮件、 联系人和文件。</span><span class="sxs-lookup"><span data-stu-id="b81b6-p104">The user account associated with the user mailbox has been hard-deleted from the Azure Active Directory. The user mailbox is now soft-deleted in Exchange Online and stays in a soft-deleted state for 30 days. If in the 30-day period a new Azure Active Directory user is synchronized from the original recipient account with the same **ExchangeGuid** or **ArchiveGuid**, and that new account is licensed for Exchange Online, this will result in a hard deletion of the original user mailbox. All mailbox content such as emails, contacts and files are permanently deleted.</span></span>
- <span data-ttu-id="b81b6-119">使用**Remove-mailbox PermanentlyDelete**删除软删除邮箱。</span><span class="sxs-lookup"><span data-stu-id="b81b6-119">A soft-deleted mailbox is deleted using **Remove-Mailbox -PermanentlyDelete**.</span></span>

<span data-ttu-id="b81b6-p105">上面的删除方案假定用户邮箱不在任何一种保留状态，如诉讼保留或电子数据展示保留。如果没有任何类型的邮箱的保留，无法删除邮箱。对于所有邮件用户收件人类型，任何[保留](https://support.office.com/article/manage-legal-investigations-in-office-365-2e5fbe9f-ee4d-4178-8ff8-4356bc1b168e?ui=en-US&rs=en-US&ad=US)设置将被忽略和硬删除或软删除没有影响。</span><span class="sxs-lookup"><span data-stu-id="b81b6-p105">The above deletion scenarios assume that the user mailbox isn't in any of the hold states, like Litigation hold or eDiscovery hold. If there is any type of hold on the mailbox, then the mailbox can't be deleted. For all mail-user recipient types, any [Hold](https://support.office.com/article/manage-legal-investigations-in-office-365-2e5fbe9f-ee4d-4178-8ff8-4356bc1b168e?ui=en-US&rs=en-US&ad=US) settings are ignored and have no effect on hard-deletions or soft-deletions.</span></span>

## <a name="soft-deleted-and-hard-deleted-items"></a><span data-ttu-id="b81b6-123">软删除和硬删除项目</span><span class="sxs-lookup"><span data-stu-id="b81b6-123">Soft-Deleted and Hard-Deleted Items</span></span>
<span data-ttu-id="b81b6-p106">当用户删除邮箱项目 （如电子邮件、 联系人、 日历约会，或任务中） 时，项目将被移动到可恢复邮件文件夹中，并到一个名为删除子。这称为软删除。长已删除项目的保留中删除文件夹取决于为邮箱已删除的邮件保留期限。默认情况下，为 14 天 Exchange Online 邮箱保留已删除的项目，但 Exchange Online 管理员可以更改此设置，以增加 30 天内的最多的时间段。（来提高 Exchange Online 邮箱的已删除的邮件保留期的详细步骤，请参阅[Exchange Online 邮箱将保留更改长永久删除项目](https://docs.microsoft.com/exchange/recipients-in-exchange-online/manage-user-mailboxes/change-deleted-item-retention)。）用户可以恢复，或清除已删除的项目之前已删除邮件的保留时间过期。为此，请他们使用在 Microsoft Outlook 或 Outlook web 上的中恢复已删除邮件功能。</span><span class="sxs-lookup"><span data-stu-id="b81b6-p106">When a user deletes a mailbox item (such as an email message, a contact, a calendar appointment, or a task), the item is moved to the Recoverable Items folder, and into a subfolder named Deletions. This is referred to as a soft deletion. How long deleted items are kept in the Deletions folder depends on the deleted item retention period that is set for the mailbox. An Exchange Online mailbox keeps deleted items for 14 days by default, but Exchange Online administrators can change this setting to increase the period up to a maximum of 30 days. (For detailed steps to increase the deleted item retention period for an Exchange Online mailbox, see [Change how long permanently deleted items are kept for an Exchange Online mailbox](https://docs.microsoft.com/exchange/recipients-in-exchange-online/manage-user-mailboxes/change-deleted-item-retention).) Users can recover, or purge, deleted items before the retention time for a deleted item expires. To do so, they use the Recover Deleted Items feature in Microsoft Outlook or Outlook on the web.</span></span>

<span data-ttu-id="b81b6-p107">如果用户使用 Outlook 或 Outlook web 上的中恢复已删除邮件功能清除已删除的项目，这称为硬删除。在 Exchange Online 中，单个项目恢复时，会启用默认情况下创建一个新的邮箱后，因此管理员仍然可以[恢复](https://docs.microsoft.com/Exchange/recipients/user-mailboxes/recover-deleted-messages)硬已删除邮件已删除的邮件保留期到期之前。此外，如果因用户或进程更改一条消息，则在启用单个项目恢复时，将还保留的原始项目副本。</span><span class="sxs-lookup"><span data-stu-id="b81b6-p107">If a user purges a deleted item by using the Recover Deleted Items feature in Outlook or Outlook on the web, this is known as a hard deletion. In Exchange Online, single item recovery is enabled by default when a new mailbox is created, so an administrator can still [recover](https://docs.microsoft.com/Exchange/recipients/user-mailboxes/recover-deleted-messages) hard-deleted items before the deleted item retention period expires. Also, if a message is changed by a user or a process, copies of the original item are also retained when single item recovery is enabled.</span></span>

## <a name="page-zeroing"></a><span data-ttu-id="b81b6-133">页面清零</span><span class="sxs-lookup"><span data-stu-id="b81b6-133">Page Zeroing</span></span>
<span data-ttu-id="b81b6-p108">*Zeroing*是通过已删除的数据写入零或一种二进制模式，以便能够更加难以恢复已删除的数据的安全机制。Exchange Online 中邮箱数据库*页面*用作其单位的存储，并实现调用*页清零*的覆盖流程。默认情况下启用，页清零，并且不能禁用客户或由 Microsoft。页清操作记录在事务日志文件，以便给定数据库的所有副本都页-清都零以类似方式。清零的主动数据库副本上的网页中使页面以获取清零的数据库的被动副本。</span><span class="sxs-lookup"><span data-stu-id="b81b6-p108">*Zeroing* is a security mechanism that writes either zeros or a binary pattern over deleted data so that the deleted data is more difficult to recover. In Exchange Online, mailbox databases use *pages* as their unit of storage, and implement an overwriting process called *page zeroing*. Page zeroing is enabled by default, and it cannot be disabled by customers or by Microsoft. Page zeroing operations are recorded in the transaction log files so that all copies of a given database are page-zeroed in a similar manner. Zeroing a page on an active database copy causes the page to get zeroed on passive copies of the database.</span></span>

<span data-ttu-id="b81b6-p109">页清零通过硬删除记录中写入一种二进制模式。页清零的模式是特定于可扩展存储引擎 (ESE) 操作 （内部数据库引擎的名称由服务器在 Exchange Online），并且它与后台数据库维护操作运行时操作的不同。（后台数据库维护是连续校验和和扫描每个数据库的过程。其主要功能是向校验和数据库页，但它还处理清理空间并出记录和由于存储崩溃出之间已不的清零的页清零）。</span><span class="sxs-lookup"><span data-stu-id="b81b6-p109">Page zeroing writes a binary pattern over hard-deleted records. The page-zeroing pattern is specific to Extensible Storage Engine (ESE) operations (the name of the internal database engine used by servers in Exchange Online), and it is different for run-time operations versus background database maintenance operations. (Background database maintenance is a process that continuously checksums and scans each database. Its primary function is to checksum database pages, but it also handles cleaning up space and zeroing out records and pages that were not zeroed out because of a Store crash.)</span></span>

<span data-ttu-id="b81b6-143">下表列出对应于特定运行时操作的填充模式。</span><span class="sxs-lookup"><span data-stu-id="b81b6-143">The following table lists the fill patterns that correspond to specific run-time operations.</span></span>

| <span data-ttu-id="b81b6-144">ESE 运行时操作</span><span class="sxs-lookup"><span data-stu-id="b81b6-144">ESE run-time operation</span></span>   | <span data-ttu-id="b81b6-145">填充模式</span><span class="sxs-lookup"><span data-stu-id="b81b6-145">Fill pattern</span></span> |
|--------------------------|--------------|
| <span data-ttu-id="b81b6-146">替换</span><span class="sxs-lookup"><span data-stu-id="b81b6-146">Replace</span></span>                  | <span data-ttu-id="b81b6-147">R</span><span class="sxs-lookup"><span data-stu-id="b81b6-147">R</span></span>            |
| <span data-ttu-id="b81b6-148">记录/长数值删除</span><span class="sxs-lookup"><span data-stu-id="b81b6-148">Record/long value delete</span></span> | <span data-ttu-id="b81b6-149">D</span><span class="sxs-lookup"><span data-stu-id="b81b6-149">D</span></span>            |
| <span data-ttu-id="b81b6-150">释放的页空间</span><span class="sxs-lookup"><span data-stu-id="b81b6-150">Freed page space</span></span>         | <span data-ttu-id="b81b6-151">H</span><span class="sxs-lookup"><span data-stu-id="b81b6-151">H</span></span>            |


<span data-ttu-id="b81b6-152">下表列出对应于在 ESE 后台数据库维护期间进行的特定操作的填充模式。</span><span class="sxs-lookup"><span data-stu-id="b81b6-152">The following table lists the fill patterns that correspond to specific operations that occur during ESE background database maintenance.</span></span>

| <span data-ttu-id="b81b6-153">ESE 后台数据库维护操作</span><span class="sxs-lookup"><span data-stu-id="b81b6-153">ESE background database maintenance operation</span></span> | <span data-ttu-id="b81b6-154">填充模式</span><span class="sxs-lookup"><span data-stu-id="b81b6-154">Fill pattern</span></span> |
|-----------------------------------------------|--------------|
| <span data-ttu-id="b81b6-155">记录删除</span><span class="sxs-lookup"><span data-stu-id="b81b6-155">Record delete</span></span>                                 | <span data-ttu-id="b81b6-156">D</span><span class="sxs-lookup"><span data-stu-id="b81b6-156">D</span></span>            |
| <span data-ttu-id="b81b6-157">长数值删除</span><span class="sxs-lookup"><span data-stu-id="b81b6-157">Long value delete</span></span>                             | <span data-ttu-id="b81b6-158">L</span><span class="sxs-lookup"><span data-stu-id="b81b6-158">L</span></span>            |
| <span data-ttu-id="b81b6-159">部分使用的页的释放页空间</span><span class="sxs-lookup"><span data-stu-id="b81b6-159">Freed page space of partially used page</span></span>       | <span data-ttu-id="b81b6-160">Z</span><span class="sxs-lookup"><span data-stu-id="b81b6-160">Z</span></span>            |
| <span data-ttu-id="b81b6-161">未使用的页的释放页空间</span><span class="sxs-lookup"><span data-stu-id="b81b6-161">Freed page space of unused page</span></span>               | <span data-ttu-id="b81b6-162">U</span><span class="sxs-lookup"><span data-stu-id="b81b6-162">U</span></span>            |


### <a name="page-zeroing-process"></a><span data-ttu-id="b81b6-163">页清零的过程</span><span class="sxs-lookup"><span data-stu-id="b81b6-163">Page Zeroing Process</span></span>
<span data-ttu-id="b81b6-p110">针对页清零的过程取决于删除方案。下表讨论数据库删除方案以及页清函数发生。</span><span class="sxs-lookup"><span data-stu-id="b81b6-p110">The process for page zeroing depends on the deletion scenario. The following table discusses database delete scenarios, and when page zeroing functions occur.</span></span>

| <span data-ttu-id="b81b6-166">数据库删除方案</span><span class="sxs-lookup"><span data-stu-id="b81b6-166">Database delete scenario</span></span> | <span data-ttu-id="b81b6-167">对数据库数据清零的 ESE 过程和时间范围</span><span class="sxs-lookup"><span data-stu-id="b81b6-167">ESE process and timeframe to zero database data</span></span> |
|-----------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="b81b6-168">项过期基于上已删除的邮件保留期限。</span><span class="sxs-lookup"><span data-stu-id="b81b6-168">Item expires based on the deleted item retention period.</span></span> | <span data-ttu-id="b81b6-p111">一个异步线程对删除的数据写入二进制模式。此操作在数毫秒的记录删除过程中发生。如果存储过程崩溃，而异步清零工作仍未完成（或由于版本存储增长而取消了版本存储清理），则当后台数据库维护处理该部分数据库时会完成清零。</span><span class="sxs-lookup"><span data-stu-id="b81b6-p111">An asynchronous thread writes a binary pattern over the deleted data. This action occurs within milliseconds of the record deletion. If the Store process crashes while the asynchronous zeroing work is still outstanding (or version store cleanup is cancelled due to version store growth), the zeroing is completed when background database maintenance processes that section of the database.</span></span> |
| <span data-ttu-id="b81b6-172">视图方案： 中的项目过期 Outlook/Outlook web 文件夹视图 （例如，对话视图）</span><span class="sxs-lookup"><span data-stu-id="b81b6-172">View Scenario: Expiration of items from Outlook/Outlook on the web folder view (for example, Conversation view)</span></span> | <span data-ttu-id="b81b6-173">当后台数据库维护处理该部分数据库时会进行数据清零。</span><span class="sxs-lookup"><span data-stu-id="b81b6-173">Data zeroing occurs when background database maintenance processes that section of the database.</span></span> |
| <span data-ttu-id="b81b6-174">移动邮箱/删除邮箱方案： 源邮箱已删除 （的已删除邮箱过期）</span><span class="sxs-lookup"><span data-stu-id="b81b6-174">Move Mailbox/Delete Mailbox Scenario: Source mailbox deleted (expiry of deleted mailbox)</span></span> | <span data-ttu-id="b81b6-175">当后台数据库维护处理该部分数据库时会进行数据清零。</span><span class="sxs-lookup"><span data-stu-id="b81b6-175">Data zeroing occurs when background database maintenance processes that section of the database.</span></span> |

### <a name="mailbox-data-types-without-page-zeroing"></a><span data-ttu-id="b81b6-176">不进行页清零的邮箱数据类型</span><span class="sxs-lookup"><span data-stu-id="b81b6-176">Mailbox Data Types without Page Zeroing</span></span>
<span data-ttu-id="b81b6-177">以下邮箱数据类型有没有针对页清零的设置：</span><span class="sxs-lookup"><span data-stu-id="b81b6-177">The following mailbox data types have no provisions for page zeroing:</span></span>
- <span data-ttu-id="b81b6-p112">**邮箱数据库事务日志**-时正常操作的一部分删除事务日志，没有为零存储已删除的日志文件在文件系统中的块的进程。很可能在文件系统将快速重新利用的可用空间用于新创建的日志，但不能保证，这会发生。</span><span class="sxs-lookup"><span data-stu-id="b81b6-p112">**Mailbox database transaction logs** - When transaction logs are deleted as part of normal operations, there is no process to zero the blocks in the file system that stored the deleted log file(s). It's likely that the file system will quickly re-utilize that free space for newly created logs, but there is no guarantee that this will happen.</span></span>
- <span data-ttu-id="b81b6-p113">**内容索引编录文件**-Exchange Online 使用搜索索引功能 Search Foundation (也称为 FAST)。搜索索引编录由存储在与邮箱数据库文件相同的卷上的多个许多文件。硬删除邮箱数据库从一条消息时，不会立即删除搜索目录中关联的内容。Search Foundation 执行时发生内容删除阴影 （或主合并） 到单个较大文件许多小型编录文件中。主合并完成后，将删除较小的编录文件。没有为零的基块的存储已删除的编录文件的进程。</span><span class="sxs-lookup"><span data-stu-id="b81b6-p113">**Content index catalog files** - Exchange Online uses Search Foundation (also known as FAST) for search indexing functionality. The search index catalog is comprised of several dozen files stored on the same volume as the mailbox database file. When a message is hard-deleted from the mailbox database, the associated content in the search catalog isn't immediately deleted. Content deletion occurs when Search Foundation does a shadow (or master merge) of many small catalog files in to a single larger file. After the master merge completes, the smaller catalog files are deleted. There is no process to zero the blocks which stored the deleted catalog files.</span></span>

## <a name="continuous-replication"></a><span data-ttu-id="b81b6-186">连续复制</span><span class="sxs-lookup"><span data-stu-id="b81b6-186">Continuous Replication</span></span>
<span data-ttu-id="b81b6-p114">连续复制 （也称为日志传送和重播） 是在 Exchange Online 中创建和维护的每个以提供高可用性和站点恢复灾难恢复的邮箱数据库副本的技术。连续复制利用 Exchange Server 数据库故障恢复支持提供执行异步更新的一个或多个邮箱数据库副本的技术。每个邮箱服务器记录为 1 MB 事务日志文件的顺序的集中日志记录数据库上的活动数据库 （例如，用户电子邮件活动） 所做的更新。这组文件称为日志流。连续复制日志流还用于异步更新数据库的一个或多个副本。通过传输日志达到此目的到包含活动数据库的被动副本，然后将它们重播到被动数据库副本的位置。如果针对数据库的被动副本重播活动数据库中的所有日志，然后两个数据库是等效的并且通过此过程对活动数据库所做的任何物理更改被复制到该数据库的所有被动副本。</span><span class="sxs-lookup"><span data-stu-id="b81b6-p114">Continuous replication (also known as log shipping and replay) is technology in Exchange Online that creates and maintains copies of every mailbox database to provide high availability, site resilience, and disaster recovery. Continuous replication leverages the Exchange Server database crash recovery support to provide technology that performs asynchronous updating of one or more copies of a mailbox database. Each mailbox server records database updates made on an active database (for example, user email activity) as log records in a sequential set of 1 MB transaction log files. This set of files is referred to as the log stream. In continuous replication, the log stream is also used to asynchronously update one or more copies of a database. This is accomplished by transmitting the logs to a location containing a passive copy of the active database and then replaying them into the passive database copy. If all logs from the active database are replayed against a passive copy of the database, then the two databases are equivalent, and it is through this process that any physical change made to an active database is replicated to all passive copies of that database.</span></span>

<span data-ttu-id="b81b6-p115">从邮箱数据库，任何删除邮箱项目或整个邮箱后，以及是否软删除或硬-删除，表示物理更改到活动的数据库。页清零也需要更改活动的数据库的物理。这些更改写入日志文件通过称为连续复制的过程和时对数据库的被动副本重放这些日志文件，将相同的物理更改对这些被动数据库。</span><span class="sxs-lookup"><span data-stu-id="b81b6-p115">Any deletion from a mailbox database, whether a mailbox item or an entire mailbox, and whether a soft-delete or a hard-delete, represents a physical change to the active database. Page zeroing also entails making physical changes to the active database. These changes are written to the log files through a process called continuous replication, and when those log files are replayed against passive copies of the database, the same physical changes are made to those passive databases.</span></span>