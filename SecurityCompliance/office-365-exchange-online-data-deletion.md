---
title: Office 365 Exchange Online 数据删除
ms.author: robmazz
author: robmazz
manager: laurawi
ms.date: 8/21/2018
audience: ITPro
ms.topic: article
ms.service: O365-seccomp
localization_priority: None
search.appverid:
- MET150
ms.collection:
- Strat_O365_IP
- M365-security-compliance
description: 如何在 Exchange Online 中处理软数据和硬数据删除。
ms.openlocfilehash: 57b58be5c38e8ba6d0ea219087ccef75cc2c2fca
ms.sourcegitcommit: f57b4001ef1327f0ea622e716a4d7d78f1769b49
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 02/23/2019
ms.locfileid: "30216912"
---
# <a name="exchange-online-data-deletion-in-office-365"></a><span data-ttu-id="35da9-103">Office 365 中的 Exchange Online 数据删除</span><span class="sxs-lookup"><span data-stu-id="35da9-103">Exchange Online Data Deletion in Office 365</span></span>
<span data-ttu-id="35da9-p101">在 Exchange Online 中, 有两种删除: 软删除和硬删除。这适用于邮箱和邮箱中的项目。</span><span class="sxs-lookup"><span data-stu-id="35da9-p101">Within Exchange Online, there are two kinds of deletions: soft deletions and hard deletions. This applies to both mailboxes and items within a mailbox.</span></span>

## <a name="soft-deleted-and-hard-deleted-mailboxes"></a><span data-ttu-id="35da9-106">软删除和硬删除邮箱</span><span class="sxs-lookup"><span data-stu-id="35da9-106">Soft-Deleted and Hard-Deleted Mailboxes</span></span>
<span data-ttu-id="35da9-p102">软删除的用户邮箱是指已使用 Office 365 管理中心或删除邮箱 cmdlet 删除的邮箱, 并且在30天内仍处于 Azure Active Directory 回收站中。可通过以下任一方式软删除邮箱:</span><span class="sxs-lookup"><span data-stu-id="35da9-p102">A soft-deleted user mailbox is a mailbox that has been deleted using the Office 365 admin center or the Remove-Mailbox cmdlet and has still been in the Azure Active Directory recycle bin for less than 30 days. A mailbox can become soft-deleted in any of the following ways:</span></span>
- <span data-ttu-id="35da9-109">用户邮箱关联的 Azure Active Directory 用户帐户已软删除 (用户对象超出范围或在回收站容器中)。</span><span class="sxs-lookup"><span data-stu-id="35da9-109">The user mailbox's associated Azure Active Directory user account is soft-deleted (the user object is out of scope or in the recycle bin container).</span></span>
- <span data-ttu-id="35da9-110">用户邮箱关联的 Azure Active Directory 用户帐户已硬删除, 但 Exchange Online 邮箱处于诉讼保留或电子数据展示保留状态。</span><span class="sxs-lookup"><span data-stu-id="35da9-110">The user mailbox's associated Azure Active Directory user account has been hard-deleted but the Exchange Online mailbox is under a litigation hold or eDiscovery hold.</span></span>
- <span data-ttu-id="35da9-111">用户邮箱关联的 Azure Active Directory 用户帐户已在最近30天内清除;这是最大保留长度的 Exchange Online 将邮箱保留为软删除状态, 然后才会永久清除和不可恢复。</span><span class="sxs-lookup"><span data-stu-id="35da9-111">The user mailbox's associated Azure Active Directory user account has been purged within the last 30 days; which is the maximum retention length Exchange Online will keep the mailbox in a soft-deleted state before it is permanently purged and unrecoverable.</span></span>

<span data-ttu-id="35da9-112">硬删除的用户邮箱是已通过以下方式之一删除的邮箱:</span><span class="sxs-lookup"><span data-stu-id="35da9-112">A hard-deleted user mailbox is a mailbox that has been deleted in one of the following ways:</span></span>
- <span data-ttu-id="35da9-p103">用户邮箱已软删除30天以上, 并且关联的 Azure Active Directory 用户已硬删除。所有邮箱内容 (如电子邮件、联系人和文件) 都将被永久删除。</span><span class="sxs-lookup"><span data-stu-id="35da9-p103">The user mailbox has been soft-deleted for more than 30 days, and the associated Azure Active Directory user has been hard-deleted. All mailbox content such as emails, contacts and files are permanently deleted.</span></span>
- <span data-ttu-id="35da9-p104">已从 Azure Active Directory 中硬删除与用户邮箱关联的用户帐户。用户邮箱现已在 Exchange Online 中软删除, 并在30天内保持软删除状态。如果在30天的时间内, 新的 Azure Active Directory 用户将与原始收件人帐户同步, 具有相同的**ExchangeGuid**或**ArchiveGuid**, 并且该新帐户已获得 Exchange Online 许可, 这将导致硬删除原始用户邮箱。所有邮箱内容 (如电子邮件、联系人和文件) 都将被永久删除。</span><span class="sxs-lookup"><span data-stu-id="35da9-p104">The user account associated with the user mailbox has been hard-deleted from the Azure Active Directory. The user mailbox is now soft-deleted in Exchange Online and stays in a soft-deleted state for 30 days. If in the 30-day period a new Azure Active Directory user is synchronized from the original recipient account with the same **ExchangeGuid** or **ArchiveGuid**, and that new account is licensed for Exchange Online, this will result in a hard deletion of the original user mailbox. All mailbox content such as emails, contacts and files are permanently deleted.</span></span>
- <span data-ttu-id="35da9-119">使用**删除邮箱-PermanentlyDelete**删除软删除邮箱。</span><span class="sxs-lookup"><span data-stu-id="35da9-119">A soft-deleted mailbox is deleted using **Remove-Mailbox -PermanentlyDelete**.</span></span>

<span data-ttu-id="35da9-p105">上述删除方案假定用户邮箱不处于任何保留状态, 如诉讼保留或电子数据展示保留。如果邮箱上有任何类型的保留, 则不能删除邮箱。对于所有邮件用户收件人类型, 任何[保留](https://support.office.com/article/manage-legal-investigations-in-office-365-2e5fbe9f-ee4d-4178-8ff8-4356bc1b168e?ui=en-US&rs=en-US&ad=US)设置都将被忽略, 并且不会影响硬删除或软删除。</span><span class="sxs-lookup"><span data-stu-id="35da9-p105">The above deletion scenarios assume that the user mailbox isn't in any of the hold states, like Litigation hold or eDiscovery hold. If there is any type of hold on the mailbox, then the mailbox can't be deleted. For all mail-user recipient types, any [Hold](https://support.office.com/article/manage-legal-investigations-in-office-365-2e5fbe9f-ee4d-4178-8ff8-4356bc1b168e?ui=en-US&rs=en-US&ad=US) settings are ignored and have no effect on hard-deletions or soft-deletions.</span></span>

## <a name="soft-deleted-and-hard-deleted-items"></a><span data-ttu-id="35da9-123">软删除和硬删除项目</span><span class="sxs-lookup"><span data-stu-id="35da9-123">Soft-Deleted and Hard-Deleted Items</span></span>
<span data-ttu-id="35da9-p106">当用户删除邮箱项目 (如电子邮件、联系人、日历约会或任务) 时, 该项目将移动到 "可恢复的项目" 文件夹中, 并将其移动到名为 "删除" 的子文件夹中。这称为软删除。删除的项目在 "删除" 文件夹中保留的时间取决于为邮箱设置的 "已删除邮件" 保留期。默认情况下, exchange online 邮箱会将已删除项目保留14天, 但 exchange online 管理员可以将此设置更改为最多30天的时间。(有关提高 exchange online 邮箱的已删除邮件保留期的详细步骤, 请参阅[更改为 exchange online 邮箱保留永久删除的项目的时间](https://docs.microsoft.com/exchange/recipients-in-exchange-online/manage-user-mailboxes/change-deleted-item-retention)。)用户可以在已删除项目的保留时间过期之前恢复或清除其删除的项目。为此, 它们使用 Microsoft Outlook 或 web 上的 Outlook 中的 "恢复已删除邮件" 功能。</span><span class="sxs-lookup"><span data-stu-id="35da9-p106">When a user deletes a mailbox item (such as an email message, a contact, a calendar appointment, or a task), the item is moved to the Recoverable Items folder, and into a subfolder named Deletions. This is referred to as a soft deletion. How long deleted items are kept in the Deletions folder depends on the deleted item retention period that is set for the mailbox. An Exchange Online mailbox keeps deleted items for 14 days by default, but Exchange Online administrators can change this setting to increase the period up to a maximum of 30 days. (For detailed steps to increase the deleted item retention period for an Exchange Online mailbox, see [Change how long permanently deleted items are kept for an Exchange Online mailbox](https://docs.microsoft.com/exchange/recipients-in-exchange-online/manage-user-mailboxes/change-deleted-item-retention).) Users can recover, or purge, deleted items before the retention time for a deleted item expires. To do so, they use the Recover Deleted Items feature in Microsoft Outlook or Outlook on the web.</span></span>

<span data-ttu-id="35da9-p107">如果用户使用 outlook 或 web 上的 outlook 中的 "恢复已删除邮件" 功能清除已删除的项目, 这就称为硬删除。在 Exchange Online 中, 创建新邮箱时, 默认情况下会启用单个项目恢复, 这样管理员仍可以在已删除项目的保留期过期之前[恢复](https://docs.microsoft.com/Exchange/recipients/user-mailboxes/recover-deleted-messages)硬删除的邮件。此外, 如果用户或进程更改了某封邮件, 则在启用单个项目恢复时, 也会保留原始项目的副本。</span><span class="sxs-lookup"><span data-stu-id="35da9-p107">If a user purges a deleted item by using the Recover Deleted Items feature in Outlook or Outlook on the web, this is known as a hard deletion. In Exchange Online, single item recovery is enabled by default when a new mailbox is created, so an administrator can still [recover](https://docs.microsoft.com/Exchange/recipients/user-mailboxes/recover-deleted-messages) hard-deleted items before the deleted item retention period expires. Also, if a message is changed by a user or a process, copies of the original item are also retained when single item recovery is enabled.</span></span>

## <a name="page-zeroing"></a><span data-ttu-id="35da9-133">页面清零</span><span class="sxs-lookup"><span data-stu-id="35da9-133">Page Zeroing</span></span>
<span data-ttu-id="35da9-p108">*清零*是一种安全机制, 它可以对删除的数据写入零或二进制模式, 以便更难以恢复删除的数据。在 Exchange Online 中, 邮箱数据库将*页面*用作存储单元, 并实现称为*页面清零*的覆盖过程。默认情况下会启用页面清零, 且不能被客户或 Microsoft 禁用。将页面清零操作记录在事务日志文件中, 以便给定数据库的所有副本都以类似的方式进行页清零。对活动数据库副本的页面进行清零会导致页面在数据库的被动副本上被清零。</span><span class="sxs-lookup"><span data-stu-id="35da9-p108">*Zeroing* is a security mechanism that writes either zeros or a binary pattern over deleted data so that the deleted data is more difficult to recover. In Exchange Online, mailbox databases use *pages* as their unit of storage, and implement an overwriting process called *page zeroing*. Page zeroing is enabled by default, and it cannot be disabled by customers or by Microsoft. Page zeroing operations are recorded in the transaction log files so that all copies of a given database are page-zeroed in a similar manner. Zeroing a page on an active database copy causes the page to get zeroed on passive copies of the database.</span></span>

<span data-ttu-id="35da9-p109">页面清零会将二进制模式写入硬删除记录。页面清零模式特定于可扩展存储引擎 (ESE) 操作 (Exchange Online 中的服务器所使用的内部数据库引擎的名称), 并且与后台数据库维护操作的运行时操作不同。(后台数据库维护是持续校验和扫描每个数据库的过程。它的主要功能是校验数据库页的校验和, 但它还处理清理空间, 并将未清零的记录和页面清零, 因为存储发生故障。</span><span class="sxs-lookup"><span data-stu-id="35da9-p109">Page zeroing writes a binary pattern over hard-deleted records. The page-zeroing pattern is specific to Extensible Storage Engine (ESE) operations (the name of the internal database engine used by servers in Exchange Online), and it is different for run-time operations versus background database maintenance operations. (Background database maintenance is a process that continuously checksums and scans each database. Its primary function is to checksum database pages, but it also handles cleaning up space and zeroing out records and pages that were not zeroed out because of a Store crash.)</span></span>

<span data-ttu-id="35da9-143">下表列出对应于特定运行时操作的填充模式。</span><span class="sxs-lookup"><span data-stu-id="35da9-143">The following table lists the fill patterns that correspond to specific run-time operations.</span></span>

| <span data-ttu-id="35da9-144">ESE 运行时操作</span><span class="sxs-lookup"><span data-stu-id="35da9-144">ESE run-time operation</span></span>   | <span data-ttu-id="35da9-145">填充模式</span><span class="sxs-lookup"><span data-stu-id="35da9-145">Fill pattern</span></span> |
|--------------------------|--------------|
| <span data-ttu-id="35da9-146">替换</span><span class="sxs-lookup"><span data-stu-id="35da9-146">Replace</span></span>                  | <span data-ttu-id="35da9-147">R</span><span class="sxs-lookup"><span data-stu-id="35da9-147">R</span></span>            |
| <span data-ttu-id="35da9-148">记录/长数值删除</span><span class="sxs-lookup"><span data-stu-id="35da9-148">Record/long value delete</span></span> | <span data-ttu-id="35da9-149">D</span><span class="sxs-lookup"><span data-stu-id="35da9-149">D</span></span>            |
| <span data-ttu-id="35da9-150">释放的页空间</span><span class="sxs-lookup"><span data-stu-id="35da9-150">Freed page space</span></span>         | <span data-ttu-id="35da9-151">H</span><span class="sxs-lookup"><span data-stu-id="35da9-151">H</span></span>            |


<span data-ttu-id="35da9-152">下表列出对应于在 ESE 后台数据库维护期间进行的特定操作的填充模式。</span><span class="sxs-lookup"><span data-stu-id="35da9-152">The following table lists the fill patterns that correspond to specific operations that occur during ESE background database maintenance.</span></span>

| <span data-ttu-id="35da9-153">ESE 后台数据库维护操作</span><span class="sxs-lookup"><span data-stu-id="35da9-153">ESE background database maintenance operation</span></span> | <span data-ttu-id="35da9-154">填充模式</span><span class="sxs-lookup"><span data-stu-id="35da9-154">Fill pattern</span></span> |
|-----------------------------------------------|--------------|
| <span data-ttu-id="35da9-155">记录删除</span><span class="sxs-lookup"><span data-stu-id="35da9-155">Record delete</span></span>                                 | <span data-ttu-id="35da9-156">D</span><span class="sxs-lookup"><span data-stu-id="35da9-156">D</span></span>            |
| <span data-ttu-id="35da9-157">长数值删除</span><span class="sxs-lookup"><span data-stu-id="35da9-157">Long value delete</span></span>                             | <span data-ttu-id="35da9-158">L</span><span class="sxs-lookup"><span data-stu-id="35da9-158">L</span></span>            |
| <span data-ttu-id="35da9-159">部分使用的页的释放页空间</span><span class="sxs-lookup"><span data-stu-id="35da9-159">Freed page space of partially used page</span></span>       | <span data-ttu-id="35da9-160">Z</span><span class="sxs-lookup"><span data-stu-id="35da9-160">Z</span></span>            |
| <span data-ttu-id="35da9-161">未使用的页的释放页空间</span><span class="sxs-lookup"><span data-stu-id="35da9-161">Freed page space of unused page</span></span>               | <span data-ttu-id="35da9-162">U</span><span class="sxs-lookup"><span data-stu-id="35da9-162">U</span></span>            |


### <a name="page-zeroing-process"></a><span data-ttu-id="35da9-163">页面清零过程</span><span class="sxs-lookup"><span data-stu-id="35da9-163">Page Zeroing Process</span></span>
<span data-ttu-id="35da9-p110">页面清零的过程取决于删除方案。下表讨论数据库删除方案以及何时出现页面清零函数。</span><span class="sxs-lookup"><span data-stu-id="35da9-p110">The process for page zeroing depends on the deletion scenario. The following table discusses database delete scenarios, and when page zeroing functions occur.</span></span>

| <span data-ttu-id="35da9-166">数据库删除方案</span><span class="sxs-lookup"><span data-stu-id="35da9-166">Database delete scenario</span></span> | <span data-ttu-id="35da9-167">对数据库数据清零的 ESE 过程和时间范围</span><span class="sxs-lookup"><span data-stu-id="35da9-167">ESE process and timeframe to zero database data</span></span> |
|-----------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <span data-ttu-id="35da9-168">项目将根据已删除项目的保留期而过期。</span><span class="sxs-lookup"><span data-stu-id="35da9-168">Item expires based on the deleted item retention period.</span></span> | <span data-ttu-id="35da9-p111">一个异步线程对删除的数据写入二进制模式。此操作在数毫秒的记录删除过程中发生。如果存储过程崩溃，而异步清零工作仍未完成（或由于版本存储增长而取消了版本存储清理），则当后台数据库维护处理该部分数据库时会完成清零。</span><span class="sxs-lookup"><span data-stu-id="35da9-p111">An asynchronous thread writes a binary pattern over the deleted data. This action occurs within milliseconds of the record deletion. If the Store process crashes while the asynchronous zeroing work is still outstanding (or version store cleanup is cancelled due to version store growth), the zeroing is completed when background database maintenance processes that section of the database.</span></span> |
| <span data-ttu-id="35da9-172">查看方案: outlook/outlook on the web folder view (例如对话视图) 中的项目过期</span><span class="sxs-lookup"><span data-stu-id="35da9-172">View Scenario: Expiration of items from Outlook/Outlook on the web folder view (for example, Conversation view)</span></span> | <span data-ttu-id="35da9-173">当后台数据库维护处理该部分数据库时会进行数据清零。</span><span class="sxs-lookup"><span data-stu-id="35da9-173">Data zeroing occurs when background database maintenance processes that section of the database.</span></span> |
| <span data-ttu-id="35da9-174">移动邮箱/删除邮箱方案: 源邮箱已删除 (已删除邮箱过期)</span><span class="sxs-lookup"><span data-stu-id="35da9-174">Move Mailbox/Delete Mailbox Scenario: Source mailbox deleted (expiry of deleted mailbox)</span></span> | <span data-ttu-id="35da9-175">当后台数据库维护处理该部分数据库时会进行数据清零。</span><span class="sxs-lookup"><span data-stu-id="35da9-175">Data zeroing occurs when background database maintenance processes that section of the database.</span></span> |

### <a name="mailbox-data-types-without-page-zeroing"></a><span data-ttu-id="35da9-176">不进行页清零的邮箱数据类型</span><span class="sxs-lookup"><span data-stu-id="35da9-176">Mailbox Data Types without Page Zeroing</span></span>
<span data-ttu-id="35da9-177">以下邮箱数据类型对页面清零没有任何规定:</span><span class="sxs-lookup"><span data-stu-id="35da9-177">The following mailbox data types have no provisions for page zeroing:</span></span>
- <span data-ttu-id="35da9-p112">**邮箱数据库事务日志**-当事务日志作为正常操作的一部分被删除时, 存储已删除的日志文件的文件系统中将不会有零个进程。文件系统可能会迅速为新创建的日志重新利用该可用空间, 但不能保证会发生这种情况。</span><span class="sxs-lookup"><span data-stu-id="35da9-p112">**Mailbox database transaction logs** - When transaction logs are deleted as part of normal operations, there is no process to zero the blocks in the file system that stored the deleted log file(s). It's likely that the file system will quickly re-utilize that free space for newly created logs, but there is no guarantee that this will happen.</span></span>
- <span data-ttu-id="35da9-p113">**内容索引目录文件**-Exchange Online 使用搜索基础 (也称为 FAST) 搜索索引功能。搜索索引目录由存储在与邮箱数据库文件相同的卷上的多个文件组成。当从邮箱数据库中硬删除邮件时, 不会立即删除搜索目录中的相关内容。当 Search Foundation 在一个较大的文件中执行多个小目录文件的阴影 (或主合并) 时, 将发生内容删除。主合并完成后, 较小的编录文件将被删除。对于存储已删除的目录文件的块, 不会有任何进程为零。</span><span class="sxs-lookup"><span data-stu-id="35da9-p113">**Content index catalog files** - Exchange Online uses Search Foundation (also known as FAST) for search indexing functionality. The search index catalog is comprised of several dozen files stored on the same volume as the mailbox database file. When a message is hard-deleted from the mailbox database, the associated content in the search catalog isn't immediately deleted. Content deletion occurs when Search Foundation does a shadow (or master merge) of many small catalog files in to a single larger file. After the master merge completes, the smaller catalog files are deleted. There is no process to zero the blocks which stored the deleted catalog files.</span></span>

## <a name="continuous-replication"></a><span data-ttu-id="35da9-186">连续复制</span><span class="sxs-lookup"><span data-stu-id="35da9-186">Continuous Replication</span></span>
<span data-ttu-id="35da9-p114">连续复制 (也称为日志传送和重播) 是 Exchange Online 中的技术, 它可创建和维护每个邮箱数据库的副本, 以提供高可用性、站点恢复能力和灾难恢复。连续复制利用 Exchange Server 数据库崩溃恢复支持, 以提供对邮箱数据库的一个或多个副本执行异步更新的技术。每个邮箱服务器都将在一组连续的 1 MB 事务日志文件中的日志记录记录在活动数据库 (例如, 用户电子邮件活动) 上进行的数据库更新。这组文件称为 "日志流"。在连续复制中, 日志流还用于异步更新数据库的一个或多个副本。这是通过将日志传输到包含活动数据库的被动副本的位置来实现的, 然后将这些日志重放到被动数据库副本中。如果对数据库的被动副本重播活动数据库中的所有日志, 则这两个数据库是等效的, 并且通过此过程, 对主动数据库所做的任何物理更改都会复制到该数据库的所有被动副本。</span><span class="sxs-lookup"><span data-stu-id="35da9-p114">Continuous replication (also known as log shipping and replay) is technology in Exchange Online that creates and maintains copies of every mailbox database to provide high availability, site resilience, and disaster recovery. Continuous replication leverages the Exchange Server database crash recovery support to provide technology that performs asynchronous updating of one or more copies of a mailbox database. Each mailbox server records database updates made on an active database (for example, user email activity) as log records in a sequential set of 1 MB transaction log files. This set of files is referred to as the log stream. In continuous replication, the log stream is also used to asynchronously update one or more copies of a database. This is accomplished by transmitting the logs to a location containing a passive copy of the active database and then replaying them into the passive database copy. If all logs from the active database are replayed against a passive copy of the database, then the two databases are equivalent, and it is through this process that any physical change made to an active database is replicated to all passive copies of that database.</span></span>

<span data-ttu-id="35da9-p115">任何从邮箱数据库中删除、邮箱项目或整个邮箱以及软删除或硬删除的删除都表示对活动数据库的物理更改。页面清零还需要对活动数据库进行物理更改。这些更改通过一个称为 "连续复制" 的过程写入日志文件, 当这些日志文件重放到数据库的被动副本时, 对这些被动数据库进行相同的物理更改。</span><span class="sxs-lookup"><span data-stu-id="35da9-p115">Any deletion from a mailbox database, whether a mailbox item or an entire mailbox, and whether a soft-delete or a hard-delete, represents a physical change to the active database. Page zeroing also entails making physical changes to the active database. These changes are written to the log files through a process called continuous replication, and when those log files are replayed against passive copies of the database, the same physical changes are made to those passive databases.</span></span>