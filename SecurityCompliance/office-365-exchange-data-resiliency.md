---
title: Office 365 Exchange 数据恢复能力
ms.author: robmazz
author: robmazz
manager: laurawi
ms.date: 8/21/2018
audience: ITPro
ms.topic: article
ms.service: Office 365 Administration
localization_priority: None
search.appverid:
- MET150
ms.collection: Strat_O365_Enterprise
description: Exchange Online 和 Office 365 中的数据恢复能力的各个方面的说明。
ms.openlocfilehash: 8d0448a95f010b766faf852a374513a1c2da61fa
ms.sourcegitcommit: 36c5466056cdef6ad2a8d9372f2bc009a30892bb
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 08/27/2018
ms.locfileid: "22525298"
---
# <a name="exchange-online-data-resiliency-in-office-365"></a>Office 365 中的 Exchange Online 数据恢复能力

## <a name="introduction"></a>简介
有两种类型的可影响 Exchange 数据库损坏： 物理损坏，通常由 （在特定，存储硬件） 的硬件问题和逻辑损坏，由于其他因素，发生此事件。一般情况下，有两种类型的逻辑可以在 Exchange 数据库中出现的损坏： 
- **数据库逻辑损坏**的数据库页的校验和匹配，但页上的数据不正确逻辑。数据库引擎 (可扩展存储引擎 (ESE)) 尝试写入数据库页时，并且即使操作系统返回成功消息，可能会发生此问题，数据也永远不会写入磁盘或它写入错误的位置。这称为*刷新丢失*。ESE 包括许多功能和旨在防止数据库和其他数据丢失方案的物理损坏的安全保护。若要防止数据丢失丢失的刷新，ESE 一起纠正的功能 （单个页面还原） 数据库中包括丢失刷新检测机制。 
- **存储逻辑损坏**的数据是添加、 删除或对其进行处理的用户不希望方式。第三方应用程序通常被由于这些情况。通常是仅意义上说，以便用户可以查看它为损坏的损坏。在 Exchange 存储认为生成为一系列有效 MAPI 操作的逻辑损坏事务。Exchange Online 中的[就地保留](https://docs.microsoft.com/exchange/security-and-compliance/create-or-remove-in-place-holds)功能提供防止存储逻辑损坏 （因为这样可以防止内容被永久删除用户或应用程序）。 

Exchange Online 执行日志检查和日志重播过程中复制的日志文件中的多个一致性检查。这些一致性检查防止从所复制的系统的物理损坏。例如，日志检查过程中没有一个物理完整性检查，以验证日志文件和验证日志文件中记录的校验和匹配在内存中生成的校验和。此外，检查日志文件标头的以确保日志标头中记录的日志文件签名匹配的日志文件。日志重播在日志文件进行进一步煜 ・ ｣ ｡。例如，数据库头还包含其中与日志文件的签名，以确保它们匹配进行比较的日志签名。 

Exchange Online 中的邮箱数据损坏防范被通过使用 Exchange 本机数据保护，利用跨多个服务器和多个数据中心以及其他应用程序级复制恢复策略帮助防止数据损坏或其他原因而由于丢失的功能。这些功能包括由 Microsoft 或 Exchange Online 应用程序本身，如管理的本机功能：

- [数据可用性组](https://docs.microsoft.com/exchange/back-up-email)
- 单个位更正 
- 扫描的联机数据库 
- 丢失的刷新检测 
- 单个页面还原 
- 邮箱复制服务 
- 日志文件检查 
- 复原文件系统上的部署 

上面列出的本机功能的详细信息，单击上面的超链接，并参阅下方的其他信息以及没有超链接的项目的详细信息。除了这些本机功能，Exchange Online 还包括客户可以管理，如的数据恢复能力功能： 
- [（默认情况下启用） 的单个项目恢复](https://docs.microsoft.com/exchange/recipients-in-exchange-online/manage-user-mailboxes/recover-deleted-messages) 
- [就地保留和诉讼保留](https://docs.microsoft.com/exchange/security-and-compliance/in-place-and-litigation-holds) 
- [已删除邮件的保留期和 Soft-Deleted 邮箱 （均默认情况下启用）](https://docs.microsoft.com/exchange/recipients-in-exchange-online/delete-or-restore-mailboxes) 

## <a name="database-availability-groups"></a>数据库可用性组 
Office 365 中的每个邮箱数据库是承载[数据库可用性组 (DAG)](https://docs.microsoft.com/exchange/back-up-email)中，并且复制到地理上单独数据中心中的相同区域。最常见的配置是在四个数据中心; 中的四个数据库副本但是，某些区域具有更少 （数据库复制到在印度，三个数据中心和澳大利亚和日本中的两个数据中心） 的数据中心。但在所有情况下，每个邮箱数据库有四个副本分布于多个数据中心，从而确保邮箱数据防止软件、 硬件和即使数据中心故障。 

利用以下四个副本，有三种它们配置为具有高可用性。第四个副本被配置为[滞后数据库副本](https://docs.microsoft.com/Exchange/high-availability/manage-ha/activate-lagged-db-copies)。滞后的数据库副本不是单个邮箱恢复或邮箱项目的恢复。其用途是提供系统范围的灾难性逻辑损坏的极少数事件的恢复机制。 

Exchange Online 中的滞后的数据库副本使用的七天的日志文件重播延迟时间配置。此外，Exchange 重播延迟经理能够提供动态日志文件减少滞后副本，以允许滞后的数据库副本自我修复和管理日志文件增长。尽管滞后的数据库副本使用 Exchange Online 中，务必了解它们不保证的时间点备份。Exchange Online 中的滞后的数据库副本具有 （由于自动减少），以及复制可用性阈值通常约 90%，由于其中包含滞后的副本的磁盘是由于磁盘失败，滞后副本成为一个高可用性而导致丢失的时间段作为期间滞后的数据库副本正在重新生成日志重播队列。 

## <a name="transport-resilience"></a>传输复原能力 
Exchange Online 包括两个主要传输复原能力： 卷影冗余和安全网络。在传输过程中时，卷影冗余保留邮件的冗余副本。Safety Net 邮件成功传递之后保留邮件的冗余副本。 

使用卷影冗余，每个 Exchange Online 传输服务器创建每个其接收消息之前它认可成功接收邮件的发送服务器的副本。这样，所有邮件的传输管道中在传输过程中的冗余。如果 Exchange Online 确定原始邮件在传输过程中丢失，是重新传送邮件的冗余副本。 

安全网络是与邮箱服务器上的传输服务相关联的传输队列。此队列存储服务器成功处理的邮件的副本。当邮箱数据库或服务器故障需要激活邮箱数据库的过期的副本时，请 Safety Net 队列中的邮件将自动重新提交到新的主动副本的邮箱数据库中。安全网络也是冗余，从而消除为单点故障的传输。如果主 Safety Net 12 个小时以上不可，其中使用主 Safety Net 和卷影 Safety Net 的概念、 重新提交请求成为阴影重新提交请求，并且从卷影 Safety Net 重新传送消息。

从 Safety Net 重新的邮件提交自动启动的活动管理器组件管理 Dag 和邮箱的 Microsoft Exchange 复制服务的数据库副本。不需要任何手动操作，以重新提交邮件从 Safety Net。 

## <a name="single-bit-correction"></a>单个位更正 
ESE 包括一种机制来检测和解决单一位 CRC 错误 （也称为单一位翻转） 的硬件错误的结果 （并因此它们表示物理损坏）。时出现这些错误，则 ESE 自动更正这些和事件日志中记录一个事件。 

## <a name="online-database-scanning"></a>扫描的联机数据库 
扫描 (也称为*数据库校验和*) 的联机数据库是其中 ESE 使用数据库一致性检查读取每个页，并检查页已损坏的过程。主要用途是检测物理损坏和可能不会获取检测事务性操作的丢失的刷新。数据库扫描还执行后存储崩溃操作。可以崩溃，由于泄露空间和联机数据库扫描查找并恢复丢失的空间。系统设计与预期的每个数据库进行完全扫描一次每七天。 

## <a name="lost-flush-detection"></a>丢失的刷新检测 
丢失的刷新时发生磁盘子系统/运行系统返回为已完成数据库写入操作未不实际获取写入磁盘，或已编写的错误的位置。丢失刷新事件可以数据库逻辑损坏，因此，以防止丢失的刷新从而导致数据丢失，ESE 结果包括丢失刷新检测机制。为数据库页被写入被动副本，为丢失刷新活动副本上执行检查。如果检测到丢失的刷新，ESE 可以修复使用修补过程的页的过程。 

## <a name="single-page-restore"></a>单个页面还原 
单个页面还原，也称为*进行页面修补*是一个其中损坏的数据库页面会替换为正常副本从正常副本的自动过程。为损坏的页面的修复过程取决于主动或被动数据库副本是否。当主动数据库副本遇到损坏的页面时，它可以从其副本，之一复制页面，前提是它将复制的页是完全保持最新。通过将页面请求放到日志流，这是邮箱数据库复制的基础达到此目的。只要副本遇到页面请求它的响应通过将页上的副本发送到请求的数据库副本。单个页面还原还提供了用于从副本，请求页面在活动异步通信机制，即使的副本都是当前处于脱机状态。 

出现在被动数据库副本，损坏时包括滞后的数据库副本，因为这些副本始终位于其主动副本，它始终是安全地将任何页面主动副本中复制到被动副本。被动数据库副本是通过性质高度可用，因此期间修补过程页上，挂起日志重播，但继续进行日志复制。被动数据库副本从主动副本中检索损坏的页面的副本，等待，直到日志文件达到最大所需的日志生成要求复制和已检查，然后修补程序损坏的页。一旦已修补页上，恢复日志重播。过程是相同的滞后的数据库副本，只不过滞后的数据库首先重播所有所需实现可修补状态的日志文件。 

## <a name="mailbox-replication-service"></a>邮箱复制服务 
移动邮箱是管理大型电子邮件服务的关键部分。始终有更新的技术和处理，因此无稳固限制系统，它使我们的工程师以完成邮箱在保持此工作的硬件和版本升级移动透明向用户 （确保它们保持联机在整个过程） 是密钥并确保的过程随着正常邮箱获取越来越大。 

Exchange 邮箱复制服务 (MRS) 负责为数据库之间移动邮箱。移动，期间 MRS 执行一致性检查邮箱内的所有项目。如果找到一致性问题，则将解决此问题，MRS 或将其跳过已损坏的项目，从而从邮箱中删除损坏。 

因为 MRS 是 Exchange Online 的一个组件，我们可以在其代码中对表单进行更改地址新损坏的将来检测到的。例如，如果我们检测到 MRS 不能修复的一致性问题，我们可以分析损坏、 更改 MRS 代码并更正不一致 (如果我们了解如何)。 

## <a name="log-file-checks"></a>日志文件检查 
由 Exchange 数据库生成的所有事务日志文件都经历一致性检查的多个窗的体。创建日志文件后，完成第一件事是编写位模式，然后执行日志写入一系列。这样，Exchange Online 执行一系列检查 （丢失的刷新、 CRC 和其他检查），验证每个日志文件，如它编写的并再次复制时。 

## <a name="deployment-on-resilient-file-system"></a>复原文件系统上的部署 
为了帮助防止损坏发生在文件系统级别，Exchange Online 部署提供改进的恢复能力的弹性文件系统 (ReFS) 分区上。ReFS 是文件系统 Windows Server 2012 中及更高版本，旨在成为更具弹性防止数据损坏，因此最大化数据可用性和完整性。具体而言，ReFS 将改进的方式的元数据更新其提供更好地保护数据，但是会减少数据损坏的情况。它还使用校验和验证文件数据的完整性以及确保该数据损坏的元数据方便地查找和修复。 

Exchange Online 利用多个 ReFS 好处： 
- 数据完整性的多个恢复能力意味着更少数据损坏事件。减少了损坏事件意味着更少的不必要的数据库重新设定种子。 
- 元数据启用检测到损坏情况的更快地和更明确，使我们修复客户数据上运行的校验和损坏之前数据卷上出现灰色故障。
- 旨在能够很好地用于极大型数据集 — petabytes 和较大 — 不会性能的影响
- 支持使用的 Exchange Online 中，如 BitLocker 加密的其他功能。 

Exchange Online 还受益于其他 ReFS 功能： 
- **完整性 （完整性流）** -ReFS 保护很多，通常会导致数据丢失的常见错误的方式存储数据。Office 365 搜索使用完整性流来帮助早期磁盘损坏检测和文件内容的校验和。功能还可减少损坏事件由"碎写入"（当写入操作未完成由于停电等。）。 
- **可用性 （残）** — ReFS 使优先级数据的可用性。过去，文件系统通常是容易将需要脱机修复的系统的数据损坏的。尽管少，如果出现损坏，ReFS 实现抢救，从 live 卷上的命名空间中删除已损坏的数据，并确保良好的数据不产生负面影响的非可修复损坏的数据的功能。应用残功能和隔离数据损坏的 Exchange Online 数据库卷意味着，我们可以保持不受影响数据库损坏卷上正常之间损坏和修复操作的时间。这会增加通常受到此类磁盘损坏问题的数据库的可用性。 