---
title: 有关使用 Office 365 客户密钥执行服务加密的 FAQ
ms.author: krowley
author: kccross
manager: laurawi
ms.date: 7/31/2018
ms.audience: ITPro
ms.topic: article
ms.service: O365-seccomp
localization_priority: Normal
search.appverid:
- MET150
ms.assetid: 41ae293a-bd5c-4083-acd8-e1a2b4329da6
description: 除了通过 BitLocker 和分布式密钥管理器 (DKM) 启用的对卷级别加密之外, office 365 还在应用程序级别为 office 365 中的客户内容 (包括来自 Exchange 的数据) 提供了额外的加密层Online、Skype for business、SharePoint Online 和 OneDrive for business。 这称为 "服务加密"。
ms.openlocfilehash: 5e1acca69ccdd8acb986acb4d7a302d4ca3fbe8a
ms.sourcegitcommit: 8a65a29aa3bfe5dcad0ff152a7cd795e02877dd9
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 03/28/2019
ms.locfileid: "30936762"
---
# <a name="service-encryption-with-customer-key-for-office-365-faq"></a><span data-ttu-id="63cdd-104">有关使用 Office 365 客户密钥执行服务加密的 FAQ</span><span class="sxs-lookup"><span data-stu-id="63cdd-104">Service encryption with Customer Key for Office 365 FAQ</span></span>

<span data-ttu-id="63cdd-105">除了通过 BitLocker 和分布式密钥管理器 (DKM) 启用的对卷级别加密之外, office 365 还在应用程序级别为 office 365 中的客户内容 (包括来自 Exchange 的数据) 提供了额外的加密层Online、Skype for business、SharePoint Online 和 OneDrive for business。</span><span class="sxs-lookup"><span data-stu-id="63cdd-105">In addition to the baseline, volume-level encryption that's enabled through BitLocker and Distributed Key Manager (DKM), Office 365 offers an added layer of encryption at the application level for customer content in Office 365, including data from Exchange Online, Skype for Business, SharePoint Online, and OneDrive for Business.</span></span> <span data-ttu-id="63cdd-106">这称为 "服务加密"。</span><span class="sxs-lookup"><span data-stu-id="63cdd-106">This is called service encryption.</span></span>
  
<span data-ttu-id="63cdd-107">客户密钥是基于服务加密构建的, 使您能够提供和控制用于在 Office 365 中对静态数据进行加密的密钥, 如[联机服务条款 (OST)](https://www.microsoft.com/en-us/Licensing/product-licensing/products.aspx)中所述。</span><span class="sxs-lookup"><span data-stu-id="63cdd-107">Customer Key is built on service encryption and enables you to provide and control keys that are used to encrypt your data at rest in Office 365 as described in the [Online Services Terms (OST)](https://www.microsoft.com/en-us/Licensing/product-licensing/products.aspx).</span></span> <span data-ttu-id="63cdd-108">客户密钥可帮助您满足合规性义务, 因为您控制 Office 365 用于解密数据的加密密钥。</span><span class="sxs-lookup"><span data-stu-id="63cdd-108">Customer Key helps you meet compliance obligations because you control the encryption keys that Office 365 uses to decrypt data.</span></span>
  
<span data-ttu-id="63cdd-109">若要提供有关客户密钥的反馈 (包括文档), 请将你的想法、建议和观点发送到 customerkeyfeedback@microsoft.com。</span><span class="sxs-lookup"><span data-stu-id="63cdd-109">To provide feedback on Customer Key, including the documentation, send your ideas, suggestions, and perspectives to customerkeyfeedback@microsoft.com.</span></span>
  
## <a name="what-is-service-encryption-with-customer-key"></a><span data-ttu-id="63cdd-110">使用客户密钥的服务加密是什么？</span><span class="sxs-lookup"><span data-stu-id="63cdd-110">What is service encryption with Customer Key?</span></span>

<span data-ttu-id="63cdd-111">客户密钥增强了贵组织满足符合性要求的能力, 这些要求通过云服务提供商指定关键安排。</span><span class="sxs-lookup"><span data-stu-id="63cdd-111">Customer Key enhances the ability of your organization to meet the demands of compliance requirements that specify key arrangements with the cloud service provider.</span></span> <span data-ttu-id="63cdd-112">使用 "客户密钥", 可以在应用程序级别为 Office 365 数据提供和控制加密密钥。</span><span class="sxs-lookup"><span data-stu-id="63cdd-112">With Customer Key, you provide and control the encryption keys for your Office 365 data at-rest at the application level.</span></span> <span data-ttu-id="63cdd-113">因此, 如果决定退出服务, 您可以控制和撤消您的组织的密钥。</span><span class="sxs-lookup"><span data-stu-id="63cdd-113">As a result, you may exercise control and revoke your organization's keys, should you decide to exit the service.</span></span> <span data-ttu-id="63cdd-114">通过吊销密钥, 该服务无法读取数据。</span><span class="sxs-lookup"><span data-stu-id="63cdd-114">By revoking the keys, the data is unreadable to the service.</span></span> <span data-ttu-id="63cdd-115">密钥吊销是删除数据的路径中的第一步。</span><span class="sxs-lookup"><span data-stu-id="63cdd-115">Key revocation is the first step on the path towards data deletion.</span></span>

## <a name="what-office-365-data-at-rest-is-covered-by-customer-key"></a><span data-ttu-id="63cdd-116">客户密钥涵盖什么是 rest 的 Office 365 数据？</span><span class="sxs-lookup"><span data-stu-id="63cdd-116">What Office 365 data at rest is covered by Customer Key?</span></span>
<span data-ttu-id="63cdd-117"><a name="WhatDataIsCoveredbyCustomerKey"> </a></span><span class="sxs-lookup"><span data-stu-id="63cdd-117"></span></span>

<span data-ttu-id="63cdd-118">其中介绍了 SharePoint Online 网站内容以及存储在该网站上的文件以及上传到 OneDrive for business 的文件。</span><span class="sxs-lookup"><span data-stu-id="63cdd-118">SharePoint Online site content and the files stored on that site and files uploaded to OneDrive for Business are covered.</span></span> <span data-ttu-id="63cdd-119">包含 Exchange Online 邮箱内容 (电子邮件正文、日历条目和电子邮件附件的内容)。</span><span class="sxs-lookup"><span data-stu-id="63cdd-119">Exchange Online mailbox content (e-mail body, calendar entries, and content of email attachments) is covered.</span></span> <span data-ttu-id="63cdd-120">已覆盖 skype for business 中的文本对话, 但不包括 skype 会议广播录制和 skype 会议内容上载。</span><span class="sxs-lookup"><span data-stu-id="63cdd-120">Text conversations from Skype for Business are covered, but Skype Meeting Broadcast recordings and Skype Meeting content uploads are not covered.</span></span> <span data-ttu-id="63cdd-121">skype 会议直播和 skype 会议内容上载与 Office 365 中的其他所有内容一起进行加密, 但我们目前不提供对加密密钥的客户控制。</span><span class="sxs-lookup"><span data-stu-id="63cdd-121">Skype Meeting Broadcast and Skype Meeting content uploads are encrypted along with all other content in Office 365, but we currently don't offer customer control of the encryption keys.</span></span>
  
## <a name="what-is-the-difference-between-customer-key-and-bring-your-own-key-byok-with-azure-information-protection-for-exchange-online"></a><span data-ttu-id="63cdd-122">客户密钥与使用 Exchange Online 的 Azure 信息保护为你自己的密钥 (BYOK) 的区别是什么？</span><span class="sxs-lookup"><span data-stu-id="63cdd-122">What is the difference between Customer Key and Bring Your Own Key (BYOK) with Azure Information Protection for Exchange Online?</span></span>
<span data-ttu-id="63cdd-123"><a name="DiffCustomerKeyandBYOKAzureIP"> </a></span><span class="sxs-lookup"><span data-stu-id="63cdd-123"></span></span>

<span data-ttu-id="63cdd-124">这两个选项都使您能够提供和控制自己的加密密钥;但是, 使用客户密钥进行的服务加密会对静态数据进行加密, 驻留在 Office 365 服务器的 BYOK 中, 而在 Exchange Online 中使用 Azure 信息保护会对您的数据传输进行加密, 并提供持续在线和离线对适用于 Office 365 的电子邮件和附件的保护。</span><span class="sxs-lookup"><span data-stu-id="63cdd-124">Both options enable you to provide and control your own encryption keys; however, service encryption with Customer Key encrypts your data at rest, residing in Office 365 servers at-rest, while BYOK with Azure Information Protection for Exchange Online encrypts your data-in-transit and provides persistent online and offline protection for email messages and attachments for Office 365.</span></span> <span data-ttu-id="63cdd-125">使用 Exchange Online 的 Azure 信息保护的 Customer Key 和 BYOK 是互补的, 无论您是选择使用 Microsoft 服务托管的密钥还是您自己的密钥, 加密数据的同时还可以提供额外的保护。恶意攻击。</span><span class="sxs-lookup"><span data-stu-id="63cdd-125">Customer Key and BYOK with Azure Information Protection for Exchange Online are complementary, and whether you choose to use Microsoft's service-managed keys or your own keys, encrypting your data-at-rest and in-transit can provide added protection from malicious attacks.</span></span>
  
<span data-ttu-id="63cdd-126">使用 Exchange Online 的 Azure 信息保护的 BYOK 在 Office 365 邮件加密功能中提供。</span><span class="sxs-lookup"><span data-stu-id="63cdd-126">BYOK with Azure Information Protection for Exchange Online is offered in the Office 365 Message Encryption capabilities.</span></span>
  
## <a name="does-office-365-message-encryption-and-bring-your-own-key-with-azure-information-protection-change-microsofts-approach-to-third-party-data-requests-such-as-subpoenas"></a><span data-ttu-id="63cdd-127">Office 365 邮件加密和使用您自己的密钥进行 Azure 信息保护更改 Microsoft 对第三方数据请求 (如 subpoenas) 的方法？</span><span class="sxs-lookup"><span data-stu-id="63cdd-127">Does Office 365 Message Encryption and Bring Your Own Key with Azure Information Protection change Microsoft's approach to third-party data requests such as subpoenas?</span></span>
<span data-ttu-id="63cdd-128"><a name="DiffCustomerKeyandBYOKAzureIP"> </a></span><span class="sxs-lookup"><span data-stu-id="63cdd-128"></span></span>

<span data-ttu-id="63cdd-129">不能。</span><span class="sxs-lookup"><span data-stu-id="63cdd-129">No.</span></span> <span data-ttu-id="63cdd-130">Office 365 邮件加密和用于提供和控制您自己的加密密钥的选项, 为 Azure 信息保护 (AIP) 引入你自己的密钥 (BYOK) 的目的不是为了响应执法部门的 subpoenas。</span><span class="sxs-lookup"><span data-stu-id="63cdd-130">Office 365 Message Encryption and the option to provide and control your own encryption keys with Bring Your Own Key (BYOK) for Azure Information Protection (AIP) was not designed to respond to law enforcement subpoenas.</span></span> <span data-ttu-id="63cdd-131">BYOK for AIP 的 Office 365 邮件加密专为需要满足其内部或外部合规性义务的合规性客户而设计。</span><span class="sxs-lookup"><span data-stu-id="63cdd-131">Office 365 Message Encryption with BYOK for AIP was designed for compliance focused customers that need to meet their internal or external compliance obligations.</span></span> <span data-ttu-id="63cdd-132">Microsoft 会对客户数据进行非常严重的第三方请求。</span><span class="sxs-lookup"><span data-stu-id="63cdd-132">Microsoft takes third-party requests for customer data very seriously.</span></span> <span data-ttu-id="63cdd-133">作为云服务提供商, 我们始终提倡客户数据的隐私。</span><span class="sxs-lookup"><span data-stu-id="63cdd-133">As a cloud service provider, we always advocate for the privacy of customer data.</span></span> <span data-ttu-id="63cdd-134">在我们获取传唤时, 我们总是会尝试将第三方重定向到客户来获取信息。</span><span class="sxs-lookup"><span data-stu-id="63cdd-134">In the event we get a subpoena, we always attempt to redirect the third party to the customer to obtain the information.</span></span> <span data-ttu-id="63cdd-135">(请阅读 Brad Smith 的博客:[保护客户数据免受政府窥探](https://blogs.microsoft.com/blog/2013/12/04/protecting-customer-data-from-government-snooping/))。</span><span class="sxs-lookup"><span data-stu-id="63cdd-135">(Please read Brad Smith's blog: [Protecting customer data from government snooping](https://blogs.microsoft.com/blog/2013/12/04/protecting-customer-data-from-government-snooping/)).</span></span> <span data-ttu-id="63cdd-136">我们会定期发布我们在[此处](https://www.microsoft.com/en-us/trustcenter/Privacy/govt-requests-for-data)收到的请求的详细信息。</span><span class="sxs-lookup"><span data-stu-id="63cdd-136">We periodically publish detailed information of the request we receive [here](https://www.microsoft.com/en-us/trustcenter/Privacy/govt-requests-for-data).</span></span>
  
<span data-ttu-id="63cdd-137">有关详细信息, 请参阅[联机服务条款 (OST)](https://www.microsoft.com/en-us/Licensing/product-licensing/products.aspx)中有关第三方数据请求和 "客户数据泄露" 的[Microsoft 信任中心](https://www.microsoft.com/en-us/trustcenter/default.aspx)。</span><span class="sxs-lookup"><span data-stu-id="63cdd-137">See the [Microsoft Trust Center](https://www.microsoft.com/en-us/trustcenter/default.aspx) regarding third-party data requests and "Disclosure of Customer Data" in the [Online Services Terms (OST) ](https://www.microsoft.com/en-us/Licensing/product-licensing/products.aspx)for more information.</span></span>
  
## <a name="does-service-encryption-with-customer-key-change-microsofts-approach-to-third-party-data-requests-such-as-subpoenas"></a><span data-ttu-id="63cdd-138">服务加密是否具有客户密钥更改 Microsoft 对第三方数据请求 (如 subpoenas) 的方法？</span><span class="sxs-lookup"><span data-stu-id="63cdd-138">Does service encryption with Customer Key change Microsoft's approach to third-party data requests such as subpoenas?</span></span>
<span data-ttu-id="63cdd-139"><a name="DiffCustomerKeyandBYOKAzureIP"> </a></span><span class="sxs-lookup"><span data-stu-id="63cdd-139"></span></span>

<span data-ttu-id="63cdd-140">不能。</span><span class="sxs-lookup"><span data-stu-id="63cdd-140">No.</span></span> <span data-ttu-id="63cdd-141">客户密钥不旨在响应执法部门的 subpoenas。</span><span class="sxs-lookup"><span data-stu-id="63cdd-141">Customer Key was not designed to respond to law enforcement subpoenas.</span></span> <span data-ttu-id="63cdd-142">它是为管控客户设计的, 以满足其内部或外部合规性义务。</span><span class="sxs-lookup"><span data-stu-id="63cdd-142">It was designed for regulated customers to meet their internal or external compliance obligations.</span></span> <span data-ttu-id="63cdd-143">Microsoft 会对客户数据进行非常严重的第三方请求。</span><span class="sxs-lookup"><span data-stu-id="63cdd-143">Microsoft takes third-party requests for customer data very seriously.</span></span> <span data-ttu-id="63cdd-144">作为云服务提供商, 我们始终提倡客户数据的隐私。</span><span class="sxs-lookup"><span data-stu-id="63cdd-144">As a cloud service provider, we always advocate for the privacy of customer data.</span></span> <span data-ttu-id="63cdd-145">在我们获取传唤时, 我们总是会尝试将第三方重定向到客户来获取信息。</span><span class="sxs-lookup"><span data-stu-id="63cdd-145">In the event we get a subpoena, we always attempt to redirect the third party to the customer to obtain the information.</span></span> <span data-ttu-id="63cdd-146">(请阅读 Brad Smith 的博客:[保护客户数据免受政府窥探](http://blogs.microsoft.com/blog/2013/12/04/protecting-customer-data-from-government-snooping/))。</span><span class="sxs-lookup"><span data-stu-id="63cdd-146">(Please read Brad Smith's blog: [Protecting customer data from government snooping](http://blogs.microsoft.com/blog/2013/12/04/protecting-customer-data-from-government-snooping/)).</span></span> <span data-ttu-id="63cdd-147">我们会定期发布我们在[此处](https://www.microsoft.com/en-us/trustcenter/Privacy/govt-requests-for-data)收到的请求的详细信息。</span><span class="sxs-lookup"><span data-stu-id="63cdd-147">We periodically publish detailed information of the request we receive [here](https://www.microsoft.com/en-us/trustcenter/Privacy/govt-requests-for-data).</span></span>
  
<span data-ttu-id="63cdd-148">有关详细信息, 请参阅[联机服务条款 (OST)](https://www.microsoft.com/en-us/Licensing/product-licensing/products.aspx)中有关第三方数据请求和 "客户数据泄露" 的[Microsoft 信任中心](https://www.microsoft.com/en-us/trustcenter/Privacy/govt-requests-for-data)。</span><span class="sxs-lookup"><span data-stu-id="63cdd-148">See the [Microsoft Trust Center](https://www.microsoft.com/en-us/trustcenter/Privacy/govt-requests-for-data) regarding third-party data requests and "Disclosure of Customer Data" in the [Online Services Terms (OST)](https://www.microsoft.com/en-us/Licensing/product-licensing/products.aspx) for more information.</span></span> 
  
## <a name="is-fasttrack-support-available-for-implementing-customer-key"></a><span data-ttu-id="63cdd-149">是否有可用于实现客户密钥的 FastTrack 支持？</span><span class="sxs-lookup"><span data-stu-id="63cdd-149">Is FastTrack support available for implementing Customer Key?</span></span>
<span data-ttu-id="63cdd-150"><a name="DiffCustomerKeyandBYOKAzureIP"> </a></span><span class="sxs-lookup"><span data-stu-id="63cdd-150"></span></span>

<span data-ttu-id="63cdd-151">不能。</span><span class="sxs-lookup"><span data-stu-id="63cdd-151">No.</span></span> <span data-ttu-id="63cdd-152">FastTrack 仅用于收集注册客户密钥所需的租户和服务配置信息。</span><span class="sxs-lookup"><span data-stu-id="63cdd-152">FastTrack is only used to collect tenant and service configuration information that is required to register for Customer Key.</span></span> <span data-ttu-id="63cdd-153">客户密钥提供通过 FastTrack 发布, 以便客户和合作伙伴可以使用相同的方法提交所需的信息, 并轻松存档客户提供的数据。</span><span class="sxs-lookup"><span data-stu-id="63cdd-153">The Customer Key Offers are published via FastTrack so that it is convenient for customers and partners to submit this required information using the same method and for ease of archiving the data that customers provide in the Offer.</span></span>
  
<span data-ttu-id="63cdd-154">如果你需要文档之外的其他支持, 请联系 microsoft 咨询服务 (MCS)、首要现场工程 (PFE) 或 Microsoft 合作伙伴以获取帮助。</span><span class="sxs-lookup"><span data-stu-id="63cdd-154">If you need additional support beyond the documentation, contact Microsoft Consulting Services (MCS), Premier Field Engineering (PFE), or a Microsoft partner for assistance.</span></span>
  
## <a name="if-my-keys-are-destroyed-how-can-i-recover"></a><span data-ttu-id="63cdd-155">如果我的密钥已损坏, 如何进行恢复？</span><span class="sxs-lookup"><span data-stu-id="63cdd-155">If my keys are destroyed, how can I recover?</span></span>
<span data-ttu-id="63cdd-156"><a name="DiffCustomerKeyandBYOKAzureIP"> </a></span><span class="sxs-lookup"><span data-stu-id="63cdd-156"></span></span>

<span data-ttu-id="63cdd-157">可用性密钥使您能够从所管理的根密钥的意外丢失中恢复。</span><span class="sxs-lookup"><span data-stu-id="63cdd-157">The availability key provides you with the capability to recover from the unanticipated loss of root keys that you manage.</span></span> <span data-ttu-id="63cdd-158">如果丢失了根密钥, 请与 microsoft 支持部门联系, microsoft 将协助你完成启用可用性密钥的过程。</span><span class="sxs-lookup"><span data-stu-id="63cdd-158">If you lose your root keys, contact Microsoft Support and Microsoft will assist you through the process of enabling the availability key.</span></span> <span data-ttu-id="63cdd-159">你将使用可用性密钥迁移到新的数据加密策略, 并使用你预配的新密钥。</span><span class="sxs-lookup"><span data-stu-id="63cdd-159">You'll use the availability key to migrate to a new Data Encryption Policy with new keys provisioned by you.</span></span> 
  
## <a name="what-is-the-availability-key"></a><span data-ttu-id="63cdd-160">可用性密钥是什么？</span><span class="sxs-lookup"><span data-stu-id="63cdd-160">What is the availability key?</span></span>
<span data-ttu-id="63cdd-161"><a name="DiffCustomerKeyandBYOKAzureIP"> </a></span><span class="sxs-lookup"><span data-stu-id="63cdd-161"></span></span>

<span data-ttu-id="63cdd-162">可用性密钥是在创建数据加密策略时设置的根键。</span><span class="sxs-lookup"><span data-stu-id="63cdd-162">The availability key is a root key that is provisioned when you create a data encryption policy.</span></span> <span data-ttu-id="63cdd-163">可用性密钥在 Office 365 中进行存储和保护, 并且功能类似于您提供的用于与客户密钥一起使用的服务加密的两个根键。</span><span class="sxs-lookup"><span data-stu-id="63cdd-163">The availability key is stored and protected within Office 365 and is functionally similar to the two root keys that are supplied by you for use with service encryption with Customer Key.</span></span> <span data-ttu-id="63cdd-164">与在 Azure Key Vault 中提供和管理的密钥不同, 您不能直接访问可用性密钥。</span><span class="sxs-lookup"><span data-stu-id="63cdd-164">Unlike the keys that you provide and manage in Azure Key Vault, you can't directly access the availability key.</span></span> <span data-ttu-id="63cdd-165">由于以下三个原因, 可用性密钥的存储和控制特意不同于 Azure 密钥存储库密钥: 首先, 可用性密钥提供了高可用性功能, 在 Office 365 服务无法访问 Azure key 中托管的密钥的情况下。保险柜其次, 可用性密钥在两个 Azure 密钥保管库密钥丢失的情况下提供 "中断玻璃" 功能;第三, 逻辑控件的分离可提供深入防护, 防止丢失单个攻击或故障点的所有密钥。</span><span class="sxs-lookup"><span data-stu-id="63cdd-165">Storage and control of the availability key are deliberately different from Azure Key Vault keys for three reasons: first, the availability key provides a high-availability capability in the event that Office 365 services are unable to reach keys hosted in Azure Key Vault; second, the availability key provides a "break glass" capability in the event that both Azure Key Vault keys are lost; and third, the separation of logical controls provides defense-in-depth and protects against the loss of all keys from a single attack or point of failure.</span></span> <span data-ttu-id="63cdd-166">共享责任来保护密钥, 同时使用各种保护和流程进行密钥管理, 最终降低了所有密钥 (因而您的数据) 将丢失或损坏的风险。</span><span class="sxs-lookup"><span data-stu-id="63cdd-166">Sharing the responsibility to protect the keys, while using a variety of protections and processes for key management, ultimately reduces the risk that all keys (and therefore your data) will be lost or destroyed.</span></span> <span data-ttu-id="63cdd-167">Microsoft 为你提供了对可用性密钥销毁的唯一权限。</span><span class="sxs-lookup"><span data-stu-id="63cdd-167">Microsoft provides you with sole authority over the destruction of the availability key.</span></span> <span data-ttu-id="63cdd-168">根据设计, Microsoft 没有任何人可以访问可用性密钥-它只能通过 Office 365 服务代码访问。</span><span class="sxs-lookup"><span data-stu-id="63cdd-168">By design, no one at Microsoft has access to the availability key - it is only accessible by Office 365 service code.</span></span>
  
## <a name="how-many-data-encryption-policies-deps-can-i-create"></a><span data-ttu-id="63cdd-169">可以创建多少个数据加密策略 (DEPs)？</span><span class="sxs-lookup"><span data-stu-id="63cdd-169">How many data encryption policies (DEPs) can I create?</span></span>
<span data-ttu-id="63cdd-170"><a name="DiffCustomerKeyandBYOKAzureIP"> </a></span><span class="sxs-lookup"><span data-stu-id="63cdd-170"></span></span>

 <span data-ttu-id="63cdd-171">**Exchange Online 和 Skype for business:** 最高可创建 50 DEPs。</span><span class="sxs-lookup"><span data-stu-id="63cdd-171">**Exchange Online and Skype for Business:** You can create up to 50 DEPs.</span></span> 
  
 <span data-ttu-id="63cdd-172">**SharePoint Online 和 OneDrive for business:** DEP 适用于一个地理位置 (也称为地理位置) 中的数据。</span><span class="sxs-lookup"><span data-stu-id="63cdd-172">**SharePoint Online and OneDrive for Business:** A DEP applies to data in one geographic location, also called a geo.</span></span> <span data-ttu-id="63cdd-173">如果使用 Office 365 的多地理位置功能, 则可以为每个地理位置创建一个 DEP。</span><span class="sxs-lookup"><span data-stu-id="63cdd-173">If you use the multi-geo feature of Office 365, you can create one DEP per geo.</span></span> <span data-ttu-id="63cdd-174">如果您不使用多地理位置, 则可以创建一个 DEP。</span><span class="sxs-lookup"><span data-stu-id="63cdd-174">If you are not using multi-geo, you can create one DEP.</span></span>
  
## <a name="can-i-assign-a-data-encryption-policy-before-migrating-a-mailbox-to-the-cloud"></a><span data-ttu-id="63cdd-175">是否可以在将邮箱迁移到云中之前分配数据加密策略？</span><span class="sxs-lookup"><span data-stu-id="63cdd-175">Can I assign a data encryption policy before migrating a mailbox to the cloud?</span></span>
<span data-ttu-id="63cdd-176"><a name="DiffCustomerKeyandBYOKAzureIP"> </a></span><span class="sxs-lookup"><span data-stu-id="63cdd-176"></span></span>

<span data-ttu-id="63cdd-177">可以。</span><span class="sxs-lookup"><span data-stu-id="63cdd-177">Yes.</span></span> <span data-ttu-id="63cdd-178">您可以使用 Windows PowerShell cmdlet MailUser 在将邮箱迁移到 Office 365 之前向用户分配数据加密策略 (DEP)。</span><span class="sxs-lookup"><span data-stu-id="63cdd-178">You can use the Windows PowerShell cmdlet Set-MailUser to assign a data encryption policy (DEP) to the user prior to migrating the mailbox to Office 365.</span></span> <span data-ttu-id="63cdd-179">执行此操作时, 将使用分配的 DEP 在迁移内容时加密邮箱的内容。</span><span class="sxs-lookup"><span data-stu-id="63cdd-179">When you do this, the contents of the mailbox will be encrypted using the assigned DEP as the content is migrated.</span></span> <span data-ttu-id="63cdd-180">这比在邮箱迁移后分配 DEP, 然后等待加密以进行, 这可能需要数小时或数天的效率更高。</span><span class="sxs-lookup"><span data-stu-id="63cdd-180">This can be more efficient than assigning a DEP after the mailbox has already been migrated and then waiting for encryption to take place, which can take hours or possibly days.</span></span> 
  
## <a name="how-do-i-verify-that-encryption-with-customer-key-is-activated-and-office-365-has-finished-encrypting-with-customer-key"></a><span data-ttu-id="63cdd-181">如何验证是否已激活客户密钥的加密功能, 以及 Office 365 是否已完成客户密钥加密？</span><span class="sxs-lookup"><span data-stu-id="63cdd-181">How do I verify that encryption with Customer Key is activated and Office 365 has finished encrypting with Customer Key?</span></span>
<span data-ttu-id="63cdd-182"><a name="DiffCustomerKeyandBYOKAzureIP"> </a></span><span class="sxs-lookup"><span data-stu-id="63cdd-182"></span></span>

 <span data-ttu-id="63cdd-183">**Exchange Online 和 Skype for business:** 您可以[使用远程 PowerShell 连接到 Exchange Online](https://technet.microsoft.com/en-us/library/jj984289%28v=exchg.160%29.aspx) , 然后对要检查的每个邮箱使用 **[get-mailboxstatistics]** cmdlet。</span><span class="sxs-lookup"><span data-stu-id="63cdd-183">**Exchange Online and Skype for Business:** You can [connect to Exchange Online using remote PowerShell](https://technet.microsoft.com/en-us/library/jj984289%28v=exchg.160%29.aspx) and then use the **[Get-MailboxStatistics]** cmdlet for each mailbox that you want to check.</span></span> <span data-ttu-id="63cdd-184">在 get-mailboxstatistics cmdlet 的输出中, 如果邮箱已加密, 则_IsEncrypted_属性返回**true** , 如果不是, 则返回值**false** 。</span><span class="sxs-lookup"><span data-stu-id="63cdd-184">In the output from the Get-MailboxStatistics cmdlet, the  _IsEncrypted_ property returns a value of **true** if the mailbox is encrypted and a value of **false** if it's not.</span></span> <span data-ttu-id="63cdd-185">如果邮箱已加密, 则为_DataEncryptionPolicyID_属性返回的值是邮箱加密的 DEP 的 GUID。</span><span class="sxs-lookup"><span data-stu-id="63cdd-185">If the mailbox is encrypted, the value returned for the  _DataEncryptionPolicyID_ property is the GUID of the DEP with which the mailbox is encrypted.</span></span> <span data-ttu-id="63cdd-186">有关运行此 cmdlet 的详细信息, 请参阅[get-mailboxstatistics](https://technet.microsoft.com/en-us/library/bb124612%28v=exchg.160%29.aspx)和使用 PowerShell with Exchange Online。</span><span class="sxs-lookup"><span data-stu-id="63cdd-186">For more information on running this cmdlet, see [Get-MailboxStatistics](https://technet.microsoft.com/en-us/library/bb124612%28v=exchg.160%29.aspx) and using PowerShell with Exchange Online.</span></span> 
  
<span data-ttu-id="63cdd-187">如果邮箱在您分配 DEP 之后的等待时间为72小时之后未加密, 请启动邮箱移动。</span><span class="sxs-lookup"><span data-stu-id="63cdd-187">If the mailboxes aren't encrypted after waiting 72 hours from the time you assigned the DEP, initiate a mailbox move.</span></span> <span data-ttu-id="63cdd-188">为此, 请[使用远程 PowerShell 连接到 Exchange Online](https://technet.microsoft.com/en-us/library/jj984289%28v=exchg.160%29.aspx) , 然后使用 new-moverequest cmdlet, 并提供邮箱的别名, 如下所示:</span><span class="sxs-lookup"><span data-stu-id="63cdd-188">To do this, [connect to Exchange Online using remote PowerShell](https://technet.microsoft.com/en-us/library/jj984289%28v=exchg.160%29.aspx) and then use the New-MoveRequest cmdlet and provide the alias of the mailbox as follows:</span></span> 
  
```
New-MoveRequest <alias>
```

 <span data-ttu-id="63cdd-189">**SharePoint Online 和 OneDrive for business:** 您可以[连接到 SharePoint Online PowerShell](https://technet.microsoft.com/en-us/library/fp161372.aspx), 然后使用 **[SPODataEncryptionPolicy]** cmdlet 检查租户的状态。</span><span class="sxs-lookup"><span data-stu-id="63cdd-189">**SharePoint Online and OneDrive for Business:** You can [connect to SharePoint Online PowerShell](https://technet.microsoft.com/en-us/library/fp161372.aspx), and then use the **[Get-SPODataEncryptionPolicy]** cmdlet to check the status of your tenant.</span></span> <span data-ttu-id="63cdd-190">如果启用了客户密钥加密且所有站点中的所有文件均已加密, \* \* _State_\* \* 属性将返回一个**注册**值。</span><span class="sxs-lookup"><span data-stu-id="63cdd-190">The \*\* _State_\*\* property returns a value of **registered** if Customer Key encryption is enabled and all files in all sites have been encrypted.</span></span> <span data-ttu-id="63cdd-191">如果仍在进行加密, 则此 cmdlet 提供有关已完成的网站百分比的信息。</span><span class="sxs-lookup"><span data-stu-id="63cdd-191">If encryption is still in progress, this cmdlet provides information on what percentage of sites is complete.</span></span> 
  
## <a name="if-i-want-to-switch-to-a-different-set-of-keys-how-long-does-it-take-for-the-new-set-of-keys-to-protect-my-data"></a><span data-ttu-id="63cdd-192">如果我要切换到一组不同的键, 则需要多长时间才能保护我的数据的新密钥集？</span><span class="sxs-lookup"><span data-stu-id="63cdd-192">If I want to switch to a different set of keys, how long does it take for the new set of keys to protect my data?</span></span>
<span data-ttu-id="63cdd-193"><a name="DiffCustomerKeyandBYOKAzureIP"> </a></span><span class="sxs-lookup"><span data-stu-id="63cdd-193"></span></span>

 <span data-ttu-id="63cdd-194">**Exchange Online 和 Skype for business:** 在将新的 DEP 分配到邮箱时, 最长可能需要72小时才能根据新的数据加密策略 (DEP) 保护邮箱。</span><span class="sxs-lookup"><span data-stu-id="63cdd-194">**Exchange Online and Skype for Business:** It can take up to 72 hours to protect a mailbox according to a new Data Encryption Policy (DEP) from the time the new DEP is assigned to the mailbox.</span></span> 
  
 <span data-ttu-id="63cdd-195">**SharePoint Online 和 OneDrive for business:** 一旦分配了新密钥, 它最长可能需要四个小时才能重新加密整个租户。</span><span class="sxs-lookup"><span data-stu-id="63cdd-195">**SharePoint Online and OneDrive for Business:** It can take up to four hours to re-encrypt your entire tenant once a new key has been assigned.</span></span> 
  
## <a name="is-my-existing-data-stored-without-encryption-at-any-time-while-it-is-decrypted-or-encrypted-with-customer-key"></a><span data-ttu-id="63cdd-196">在使用客户密钥对其进行解密或加密时, 是否已在不加密的情况下存储现有数据？</span><span class="sxs-lookup"><span data-stu-id="63cdd-196">Is my existing data stored without encryption at any time while it is decrypted or encrypted with Customer Key?</span></span>
<span data-ttu-id="63cdd-197"><a name="DiffCustomerKeyandBYOKAzureIP"> </a></span><span class="sxs-lookup"><span data-stu-id="63cdd-197"></span></span>

<span data-ttu-id="63cdd-198">不能。</span><span class="sxs-lookup"><span data-stu-id="63cdd-198">No.</span></span> <span data-ttu-id="63cdd-199">Office 365 服务中的静态数据始终在 BitLocker 和 DKM 中进行加密。</span><span class="sxs-lookup"><span data-stu-id="63cdd-199">Your data is always encrypted at rest in the Office 365 service with BitLocker and DKM.</span></span> <span data-ttu-id="63cdd-200">有关详细信息, 请参阅 "Office 365 的安全性、隐私和合规性信息", 以及[Exchange Online 如何保护您的电子邮件密码](https://support.office.com/article/989BA10C-F73F-4EFB-AD1B-AF3322E5F376)。</span><span class="sxs-lookup"><span data-stu-id="63cdd-200">For more information, see the "Security, Privacy, and Compliance Information for Office 365", and [How Exchange Online secures your email secrets](https://support.office.com/article/989BA10C-F73F-4EFB-AD1B-AF3322E5F376).</span></span>
  
## <a name="if-i-no-longer-want-to-use-customer-managed-encryption-keys-can-i-switch-to-microsoft-managed-keys"></a><span data-ttu-id="63cdd-201">如果我不想再使用客户管理的加密密钥, 是否可以切换到 Microsoft 管理的密钥？</span><span class="sxs-lookup"><span data-stu-id="63cdd-201">If I no longer want to use customer-managed encryption keys, can I switch to Microsoft-managed keys?</span></span>
<span data-ttu-id="63cdd-202"><a name="DiffCustomerKeyandBYOKAzureIP"> </a></span><span class="sxs-lookup"><span data-stu-id="63cdd-202"></span></span>

 <span data-ttu-id="63cdd-203">**Exchange Online 和 Skype for business:** 还没有。</span><span class="sxs-lookup"><span data-stu-id="63cdd-203">**Exchange Online and Skype for Business:** Not yet.</span></span> <span data-ttu-id="63cdd-204">在 Office 365 中通过 Microsoft 托管密钥进行的服务加密将被广泛汇总。</span><span class="sxs-lookup"><span data-stu-id="63cdd-204">This will be supported once service encryption in Office 365 with Microsoft-managed keys is rolled out broadly.</span></span> <span data-ttu-id="63cdd-205">我们预计在使用客户密钥发布服务加密后, 将在服务中进行汇总。</span><span class="sxs-lookup"><span data-stu-id="63cdd-205">We expect to roll this out in the service after we release service encryption with Customer Key.</span></span> 
  
 <span data-ttu-id="63cdd-206">**SharePoint Online 和 OneDrive for business:** 是的。</span><span class="sxs-lookup"><span data-stu-id="63cdd-206">**SharePoint Online and OneDrive for Business:** Yes.</span></span> <span data-ttu-id="63cdd-207">您可以选择恢复为在每个地理位置 (如果使用多地理位置功能) 或所有数据 (如果您使用的是单个地理位置) 中单独使用 Microsoft 托管键。</span><span class="sxs-lookup"><span data-stu-id="63cdd-207">You can choose to revert to using Microsoft-managed keys separately for each geo (if you use the multi-geo feature) or for all your data if it is in a single geo.</span></span> 
  
## <a name="if-i-lose-my-keys-how-long-does-it-take-to-recover-service-availability-using-the-recovery-key"></a><span data-ttu-id="63cdd-208">如果我的密钥丢失, 使用恢复密钥恢复服务可用性需要多长时间？</span><span class="sxs-lookup"><span data-stu-id="63cdd-208">If I lose my keys, how long does it take to recover service availability using the recovery key?</span></span>
<span data-ttu-id="63cdd-209"><a name="DiffCustomerKeyandBYOKAzureIP"> </a></span><span class="sxs-lookup"><span data-stu-id="63cdd-209"></span></span>

 <span data-ttu-id="63cdd-210">**Exchange Online 和 Skype for business:** 在调用以使用可用性密钥之后, 邮箱将在几分钟内可供访问。</span><span class="sxs-lookup"><span data-stu-id="63cdd-210">**Exchange Online and Skype for Business:** Once you call in to use the availability key, mailboxes will be accessible within minutes.</span></span> 
  
 <span data-ttu-id="63cdd-211">**SharePoint Online 和 OneDrive for business:** 此操作与您拥有的网站数成比例。</span><span class="sxs-lookup"><span data-stu-id="63cdd-211">**SharePoint Online and OneDrive for Business:** This operation is proportional to the number of sites you have.</span></span> <span data-ttu-id="63cdd-212">一旦您调用 Microsoft 使用可用性密钥, 你将在大约4小时内完全在线。</span><span class="sxs-lookup"><span data-stu-id="63cdd-212">Once you call Microsoft to use the availability key, you will be fully online within about four hours.</span></span> 
  
## <a name="how-is-the-availability-key-used-with-exchange-online"></a><span data-ttu-id="63cdd-213">如何将可用性密钥用于 Exchange Online？</span><span class="sxs-lookup"><span data-stu-id="63cdd-213">How is the availability key used with Exchange Online?</span></span>
<span data-ttu-id="63cdd-214"><a name="DiffCustomerKeyandBYOKAzureIP"> </a></span><span class="sxs-lookup"><span data-stu-id="63cdd-214"></span></span>

<span data-ttu-id="63cdd-215">可用性密钥与 Exchange Online 结合使用的方式有三种:</span><span class="sxs-lookup"><span data-stu-id="63cdd-215">There are three ways that the availability key is used with Exchange Online:</span></span>
  
- <span data-ttu-id="63cdd-216">服务可用性-当 Azure 密钥保管库密钥不可访问时。</span><span class="sxs-lookup"><span data-stu-id="63cdd-216">Service availability - in the event that Azure Key Vault keys are unreachable.</span></span>
    
- <span data-ttu-id="63cdd-217">由 Office 365 服务代码启动的操作-如搜索索引创建或邮箱移动。</span><span class="sxs-lookup"><span data-stu-id="63cdd-217">Actions initiated by Office 365 service code - such as search index creation or mailbox moves.</span></span>
    
- <span data-ttu-id="63cdd-218">从密钥丢失恢复-例如, 丢失与单个 DEP 相关联的 Azure key Vault 密钥。</span><span class="sxs-lookup"><span data-stu-id="63cdd-218">Recover from key loss - such as the loss of both Azure Key Vault keys associated with a single DEP.</span></span>
    
 <span data-ttu-id="63cdd-219">**在 Azure key Vault 密钥中使用服务可用性的可用性密钥是不可访问的。**</span><span class="sxs-lookup"><span data-stu-id="63cdd-219">**Using the availability key for service availability in the event Azure Key Vault keys are unreachable.**</span></span>
  
<span data-ttu-id="63cdd-220">Office 365 使用可用性密钥来实现服务可用性, 并从 Exchange Online 的不正常客户密钥状态恢复。</span><span class="sxs-lookup"><span data-stu-id="63cdd-220">Office 365 uses the availability key both for service availability and recovery from an unhealthy Customer Key state for Exchange Online.</span></span> <span data-ttu-id="63cdd-221">有一个由客户密钥使用的密钥的层次结构。</span><span class="sxs-lookup"><span data-stu-id="63cdd-221">There is a hierarchy of keys used by Customer Key.</span></span> <span data-ttu-id="63cdd-222">此层次结构如下图所示。</span><span class="sxs-lookup"><span data-stu-id="63cdd-222">This hierarchy is illustrated in the following figure.</span></span>
  
![](media/a760156b-737f-469a-80ab-c28b7a8b9160.png)
  
<span data-ttu-id="63cdd-223">如果单个数据加密策略 (DEP) 的两个 Azure 密钥保管库密钥均不可用, 则 Office 365 可以使用可用性密钥更改为新的 DEP。</span><span class="sxs-lookup"><span data-stu-id="63cdd-223">If both Azure Key Vault keys of a single Data Encryption Policy (DEP) are unavailable, Office 365 can use the availability key to change to a new DEP.</span></span> <span data-ttu-id="63cdd-224">Office 365 根据用户启动的活动 (例如, 用户是否将电子邮件下载到 Outlook 客户端) 或系统启动的活动 (如索引), 确定是否使用可用性密钥以不同方式使用可用性密钥。邮箱内容或电子数据展示搜索触发此过程。</span><span class="sxs-lookup"><span data-stu-id="63cdd-224">Office 365 determines whether to use the availability key for service availability differently depending on whether a user-initiated activity, for example, when a user downloads email to the Outlook client, or a system-initiated activity, such as indexing mailbox contents, or for eDiscovery searches, triggered the process.</span></span>
  
<span data-ttu-id="63cdd-225">Office 365 按照此过程响应用户启动的操作, 以确定是否对用户邮箱使用可用性密钥:</span><span class="sxs-lookup"><span data-stu-id="63cdd-225">Office 365 follows this process in response to user-initiated actions to determine whether to use the availability key for user mailboxes:</span></span>
  
1. <span data-ttu-id="63cdd-226">Office 365 读取邮箱分配到的 DEP, 以便确定两个客户密钥在 Azure Key Vault 中的位置。</span><span class="sxs-lookup"><span data-stu-id="63cdd-226">Office 365 reads the DEP to which the mailbox is assigned in order to determine the location of the two customer keys in Azure Key Vault.</span></span>
    
2. <span data-ttu-id="63cdd-227">Office 365 从 DEP 中随机选择两个客户密钥中的一个, 并向 Azure key Vault 发送一个请求, 以使用客户密钥解包 DEP 密钥。</span><span class="sxs-lookup"><span data-stu-id="63cdd-227">Office 365 randomly chooses one of the two customer keys from the DEP and sends a request to Azure Key Vault to unwrap the DEP key using the customer key.</span></span>
    
3. <span data-ttu-id="63cdd-228">如果使用客户密钥对对 DEP 密钥进行解包的请求失败并返回错误, 则 Office 365 会向 Azure key Vault 发送第二个请求, 这次指示它使用备用 (第二) 客户密钥。</span><span class="sxs-lookup"><span data-stu-id="63cdd-228">If the request to unwrap the DEP key using the customer key fails and returns an error, Office 365 sends a second request to Azure Key Vault, this time instructing it to use the alternate (second) customer key.</span></span>
    
4. <span data-ttu-id="63cdd-229">如果第二个请求使用客户密钥解包 DEP 密钥失败并返回错误, 则 Office 365 会检查两个请求的结果:</span><span class="sxs-lookup"><span data-stu-id="63cdd-229">If the second request to unwrap the DEP key using the customer key fails and returns an error, Office 365 examines the results of both requests:</span></span>
    
  - <span data-ttu-id="63cdd-230">如果检查确定错误未反映客户标识的显式操作, 则 Office 365 将使用可用性密钥对 DEP 密钥进行解密。</span><span class="sxs-lookup"><span data-stu-id="63cdd-230">If the examination determines that the errors DO NOT reflect an explicit action by a customer identity, then Office 365 uses the availability key to decrypt the DEP key.</span></span> <span data-ttu-id="63cdd-231">然后, 使用 DEP 密钥来解密邮箱密钥, 并完成用户请求。</span><span class="sxs-lookup"><span data-stu-id="63cdd-231">The DEP key is then used to decrypt the mailbox key and complete the user request.</span></span>
    
    <span data-ttu-id="63cdd-232">在这种情况下, 由于任何原因, Azure 密钥存储库都无法响应或不可访问。</span><span class="sxs-lookup"><span data-stu-id="63cdd-232">In this case, Azure Key Vault is either unable to respond or unreachable for whatever reason.</span></span> <span data-ttu-id="63cdd-233">Office 365 无法确定客户是否已有意撤销对密钥的访问权限。</span><span class="sxs-lookup"><span data-stu-id="63cdd-233">Office 365 has no way of determining if the customer has intentionally revoked access to the keys.</span></span>
    
  - <span data-ttu-id="63cdd-234">如果检查表明已采取有意的措施来呈现客户密钥不可用, 则将不会使用可用性密钥, 用户请求将失败, 并且用户收到一条错误消息, 如登录失败。</span><span class="sxs-lookup"><span data-stu-id="63cdd-234">If the examination indicates that deliberate action has been taken to render the customer keys unavailable, then the availability key will not be used, the user request fails, and the user receives an error message, such as login failure.</span></span>
    
    <span data-ttu-id="63cdd-235">当发生这种情况时, 客户会意识到服务受到影响, 客户密钥的条件不正常。</span><span class="sxs-lookup"><span data-stu-id="63cdd-235">When this happens, the customer is made aware that service is impacted, and the condition of Customer Key is unhealthy.</span></span> <span data-ttu-id="63cdd-236">例如, 如果客户对组织中的所有邮箱使用一个 DEP, 则该客户可能会遇到广泛的故障, 用户无法访问其邮箱。</span><span class="sxs-lookup"><span data-stu-id="63cdd-236">For example, if a customer is using a single DEP for all mailboxes in the organization, the customer may experience a widespread failure where users can't access their mailboxes.</span></span> <span data-ttu-id="63cdd-237">这样可确保当两个客户密钥不正常时, 客户就会意识到需要纠正这种情况, 并将服务还原到正常状态。</span><span class="sxs-lookup"><span data-stu-id="63cdd-237">This ensures that when both customer keys are unhealthy, the customer is made aware of the need to correct the situation and restore the service to a healthy state.</span></span>
    
 <span data-ttu-id="63cdd-238">**使用 Office 365 服务代码启动的操作的可用性密钥。**</span><span class="sxs-lookup"><span data-stu-id="63cdd-238">**Using the availability key for actions initiated by Office 365 service code.**</span></span>
  
<span data-ttu-id="63cdd-239">Office 365 服务代码始终具有有效的登录令牌, 不能被阻止。</span><span class="sxs-lookup"><span data-stu-id="63cdd-239">Office 365 service code always has a valid login token and can't be blocked.</span></span> <span data-ttu-id="63cdd-240">因此, 在删除可用性密钥之前, 可将其用于 Office 365 服务代码 (如搜索索引创建或移动邮箱) 启动的操作或内部的操作。</span><span class="sxs-lookup"><span data-stu-id="63cdd-240">Therefore, until the availability key has been deleted, it can be used for actions initiated by, or internal to, Office 365 service code, such as search index creation or moving mailboxes.</span></span>
  
 <span data-ttu-id="63cdd-241">**使用可用性密钥从密钥丢失中恢复。**</span><span class="sxs-lookup"><span data-stu-id="63cdd-241">**Using the availability key to recover from key loss.**</span></span>
  
<span data-ttu-id="63cdd-242">您可以使用可用性密钥恢复与同一个 DEP 相关联的 Azure key Vault 密钥的丢失, 如 FAQ 条目的答案中所述, "如果我的密钥已损坏, 如何恢复？"。</span><span class="sxs-lookup"><span data-stu-id="63cdd-242">You can use the availability key to recover from the loss of both Azure Key Vault keys that are associated with the same DEP, as described in the answer to the FAQ entry "If my keys are destroyed, how can I recover?".</span></span>
  
## <a name="how-is-the-availability-key-used-with-sharepoint-online-and-onedrive-for-business"></a><span data-ttu-id="63cdd-243">SharePoint Online 和 OneDrive for business 使用的可用性密钥有何功能？</span><span class="sxs-lookup"><span data-stu-id="63cdd-243">How is the availability key used with SharePoint Online and OneDrive for Business?</span></span>
<span data-ttu-id="63cdd-244"><a name="DiffCustomerKeyandBYOKAzureIP"> </a></span><span class="sxs-lookup"><span data-stu-id="63cdd-244"></span></span>

<span data-ttu-id="63cdd-245">SharePoint online 和 OneDrive for business 体系结构以及客户密钥和可用性密钥实现不同于 Exchange Online 和 Skype for business。</span><span class="sxs-lookup"><span data-stu-id="63cdd-245">The SharePoint Online and OneDrive for Business architecture and implementation for Customer Key and availability key are different from Exchange Online and Skype for Business.</span></span>
  
<span data-ttu-id="63cdd-246">当客户移动到客户管理的密钥时, Office 365 将创建特定于租户的中间密钥 (TIK)。</span><span class="sxs-lookup"><span data-stu-id="63cdd-246">When a customer moves to customer-managed keys, Office 365 creates a tenant-specific intermediate key (TIK).</span></span> <span data-ttu-id="63cdd-247">Office 365 将 TIK 加密两次, 每个客户密钥一次, 并存储 TIK 的两个加密版本。</span><span class="sxs-lookup"><span data-stu-id="63cdd-247">Office 365 encrypts the TIK twice, once with each of the customer keys, and stores the two encrypted versions of the TIK.</span></span> <span data-ttu-id="63cdd-248">仅存储 TIK 的加密版本, 并且 TIK 只能使用客户密钥进行解密。</span><span class="sxs-lookup"><span data-stu-id="63cdd-248">Only the encrypted versions of the TIK are stored, and a TIK can only be decrypted with the customer keys.</span></span> <span data-ttu-id="63cdd-249">然后, 使用 TIK 对网站密钥进行加密, 然后使用这些密钥对 blob 密钥进行加密。</span><span class="sxs-lookup"><span data-stu-id="63cdd-249">The TIK is then used to encrypt site keys, which are then used to encrypt blob keys.</span></span> <span data-ttu-id="63cdd-250">blob 本身被加密并存储在 Microsoft Azure Blob 存储服务中。</span><span class="sxs-lookup"><span data-stu-id="63cdd-250">The blobs themselves are encrypted and stored in the Microsoft Azure Blob storage service.</span></span>
  
<span data-ttu-id="63cdd-251">Office 365 遵循此过程来访问包含客户文件数据的 blob:</span><span class="sxs-lookup"><span data-stu-id="63cdd-251">Office 365 follows this process to access a blob that has customer file data:</span></span>
  
1. <span data-ttu-id="63cdd-252">使用客户密钥对 TIK 进行解密。</span><span class="sxs-lookup"><span data-stu-id="63cdd-252">Decrypt the TIK using the Customer Key.</span></span>
    
2. <span data-ttu-id="63cdd-253">使用解密的 TIK 解密网站密钥。</span><span class="sxs-lookup"><span data-stu-id="63cdd-253">Use the decrypted TIK to decrypt a site key.</span></span>
    
3. <span data-ttu-id="63cdd-254">使用解密的网站密钥对 blob 密钥进行解密。</span><span class="sxs-lookup"><span data-stu-id="63cdd-254">Use the decrypted site key to decrypt a blob key.</span></span>
    
4. <span data-ttu-id="63cdd-255">使用解密的 blob 密钥对 blob 进行解密。</span><span class="sxs-lookup"><span data-stu-id="63cdd-255">Use the decrypted blob key to decrypt the blob.</span></span>
    
<span data-ttu-id="63cdd-256">解密 TIK 时, Office 365 会向 Azure Key Vault 颁发两个解密请求, 但具有轻微偏移量。</span><span class="sxs-lookup"><span data-stu-id="63cdd-256">When decrypting a TIK, Office 365 issues two decryption requests to Azure Key Vault with a slight offset.</span></span> <span data-ttu-id="63cdd-257">第一个要完成的提供结果, 取消了另一个请求。</span><span class="sxs-lookup"><span data-stu-id="63cdd-257">The first one to finish furnishes the result, canceling the other request.</span></span>
  
<span data-ttu-id="63cdd-258">如果客户失去对其客户密钥的访问权限, Office 365 还会使用可用性密钥对 TIK 进行加密, 并将其与使用每个客户密钥加密的 TIKs 存储在一起。</span><span class="sxs-lookup"><span data-stu-id="63cdd-258">In case the customer loses access to their customer keys, Office 365 also encrypts the TIK with an availability key and stores this along with the TIKs encrypted with each customer key.</span></span> <span data-ttu-id="63cdd-259">使用 availability 密钥加密的 TIK 仅当客户在失去对其密钥的访问权限 (恶意或意外) 时, 才将 Microsoft 用于登记恢复路径。</span><span class="sxs-lookup"><span data-stu-id="63cdd-259">The TIK encrypted with the availability key is used only when the customer calls Microsoft to enlist the recovery path when they have lost access to their keys, maliciously or accidentally.</span></span>
  
<span data-ttu-id="63cdd-260">出于可用性和扩展原因, 解密的 TIKs 缓存在一个时间有限的内存缓存中。</span><span class="sxs-lookup"><span data-stu-id="63cdd-260">For availability and scale reasons, decrypted TIKs are cached in a time-limited memory cache.</span></span> <span data-ttu-id="63cdd-261">在 TIK 缓存设置为过期之前的两个小时, Office 365 将尝试对每个 TIK 进行解密。</span><span class="sxs-lookup"><span data-stu-id="63cdd-261">Two hours before a TIK cache is set to expire, Office 365 attempts to decrypt each TIK.</span></span> <span data-ttu-id="63cdd-262">对 TIKs 进行解密会延长缓存的生存期。</span><span class="sxs-lookup"><span data-stu-id="63cdd-262">Decrypting the TIKs extends the lifetime of the cache.</span></span> <span data-ttu-id="63cdd-263">如果 TIK 解密在很长一段时间后失败, Office 365 将生成一个警报, 以在缓存过期之前通知工程。</span><span class="sxs-lookup"><span data-stu-id="63cdd-263">If TIK decryption fails for a significant amount of time, Office 365 generates an alert to notify engineering prior to the cache expiration.</span></span> <span data-ttu-id="63cdd-264">仅当客户呼叫 microsoft 时, Office 365 才会启动恢复操作, 这涉及使用存储在 Microsoft 机密存储中的可用性密钥对 TIK 进行解密, 并使用解密的 TIK 再次载入租户, 并使用一组新的客户提供的 Azure Key Vault 密钥。</span><span class="sxs-lookup"><span data-stu-id="63cdd-264">Only if the customer calls Microsoft will Office 365 initiate the recovery operation, which involves decrypting the TIK with the availability key stored in Microsoft's secret store and onboarding the tenant again using the decrypted TIK and a new set of customer-supplied Azure Key Vault keys.</span></span>
  
<span data-ttu-id="63cdd-265">到目前为止, 客户密钥包含在 Azure blob 存储中存储的 sharepoint online 文件数据的加密和解密链中, 但不包含在 SQL 数据库中存储的 sharepoint online 列表项或元数据中。</span><span class="sxs-lookup"><span data-stu-id="63cdd-265">As of today, Customer Key is involved in the encryption and decryption chain of SharePoint Online file data stored in the Azure blob store, but not SharePoint Online list items or metadata stored in the SQL database.</span></span> <span data-ttu-id="63cdd-266">除了客户启动的情况之外, Office 365 不使用 SharePoint Online 或 OneDrive for business 的可用性密钥 (而不是上面介绍的事例)。</span><span class="sxs-lookup"><span data-stu-id="63cdd-266">Office 365 does not use the availability key for SharePoint Online or OneDrive for Business other than the case described above, which is customer initiated.</span></span> <span data-ttu-id="63cdd-267">对客户数据的人对客户数据的访问受客户密码箱保护。</span><span class="sxs-lookup"><span data-stu-id="63cdd-267">Human access to customer data is protected by Customer Lockbox.</span></span>
  
## <a name="how-is-customer-key-licensed"></a><span data-ttu-id="63cdd-268">如何许可客户密钥？</span><span class="sxs-lookup"><span data-stu-id="63cdd-268">How is Customer Key licensed?</span></span>
<span data-ttu-id="63cdd-269"><a name="DiffCustomerKeyandBYOKAzureIP"> </a></span><span class="sxs-lookup"><span data-stu-id="63cdd-269"></span></span>

<span data-ttu-id="63cdd-270">客户密钥在 Office 365 企业套件、"E5" 和高级合规性 SKU 中提供。</span><span class="sxs-lookup"><span data-stu-id="63cdd-270">Customer Key is offered in the Office 365 Enterprise Suite, "E5", and the Advanced Compliance SKU.</span></span> <span data-ttu-id="63cdd-271">此外, 客户还必须购买使用 Azure Key Vault 的相应许可证。</span><span class="sxs-lookup"><span data-stu-id="63cdd-271">Additionally, customers must also purchase the appropriate license for using Azure Key Vault.</span></span>
  
<span data-ttu-id="63cdd-272">如果客户密钥需要获得客户密钥的涵盖, 则每个用户都可以从客户密钥中受益。</span><span class="sxs-lookup"><span data-stu-id="63cdd-272">Each user benefiting from Customer Key needs to be licensed if they want to be covered by Customer Key.</span></span>
  
<span data-ttu-id="63cdd-273">对于 SharePoint Online, 配置客户密钥的 Office 365 管理员也需要获得许可, 以执行设置步骤。</span><span class="sxs-lookup"><span data-stu-id="63cdd-273">For SharePoint Online, the Office 365 Administrator who configures Customer Key also needs to be licensed, to perform the setup steps.</span></span> <span data-ttu-id="63cdd-274">此外, 需要许可的用户才需要获得许可, 这包括网站所有者和访问使用客户密钥加密的一个或多个网站上的文件的用户。</span><span class="sxs-lookup"><span data-stu-id="63cdd-274">Additionally, the users that are benefiting from the feature need to be licensed - this includes the site owner and any users accessing files on one or more sites that are encrypted using Customer Key.</span></span> <span data-ttu-id="63cdd-275">外部用户无需许可即可访问使用客户密钥加密的一个或多个站点上的文件。</span><span class="sxs-lookup"><span data-stu-id="63cdd-275">External users do not need to be licensed to access files on one or more sites that are encrypted using Customer Key.</span></span>
  
<span data-ttu-id="63cdd-276">对于 Exchange Online, "用户" 邮箱和 "邮件用户" 邮箱必须获得许可。</span><span class="sxs-lookup"><span data-stu-id="63cdd-276">For Exchange Online, "user" mailboxes and "mail user" mailboxes must be licensed.</span></span> <span data-ttu-id="63cdd-277">所有其他 (如共享邮箱) 不需要拥有客户密钥许可证。</span><span class="sxs-lookup"><span data-stu-id="63cdd-277">All others, such as shared mailboxes, are not required to have a license for Customer Key.</span></span> <span data-ttu-id="63cdd-278">若要检查您的 Exchange Online 邮箱是否已得到正确许可, 请运行以下 cmdlet:</span><span class="sxs-lookup"><span data-stu-id="63cdd-278">To check that your Exchange Online mailbox is properly licensed, run the following cmdlet:</span></span>
  
```
(Get-Mailbox <alias >).PersistedCapabilities
```

<span data-ttu-id="63cdd-279">如果字符串 BPOS_S_EquivioAnalytics 存在, 则对邮箱进行了正确的授权。</span><span class="sxs-lookup"><span data-stu-id="63cdd-279">If the string BPOS_S_EquivioAnalytics exists, then the mailbox is properly licensed.</span></span> <span data-ttu-id="63cdd-280">如果不是, 则必须应用适当的许可证, 才能使用此邮箱的客户密钥功能。</span><span class="sxs-lookup"><span data-stu-id="63cdd-280">If not, you must apply the proper license in order to use the Customer Key feature for this mailbox.</span></span>
  
## <a name="can-i-enable-customer-key-for-a-trial-subscription"></a><span data-ttu-id="63cdd-281">我是否可以为试用订阅启用客户密钥？</span><span class="sxs-lookup"><span data-stu-id="63cdd-281">Can I enable Customer Key for a trial subscription?</span></span>
<span data-ttu-id="63cdd-282"><a name="DiffCustomerKeyandBYOKAzureIP"> </a></span><span class="sxs-lookup"><span data-stu-id="63cdd-282"></span></span>

<span data-ttu-id="63cdd-283">不能。</span><span class="sxs-lookup"><span data-stu-id="63cdd-283">No.</span></span> <span data-ttu-id="63cdd-284">根据定义, 试用订阅的生命周期有限。</span><span class="sxs-lookup"><span data-stu-id="63cdd-284">By definition, trial subscriptions have a limited lifetime.</span></span> <span data-ttu-id="63cdd-285">在试用版订阅结束时托管的加密密钥可能会在试用期结束时丢失。</span><span class="sxs-lookup"><span data-stu-id="63cdd-285">Encryption keys that are hosted in trial subscriptions can be lost at the end of the trial lifetime.</span></span> <span data-ttu-id="63cdd-286">由于 Microsoft 无法且不会阻止客户将重要的客户数据放在试用订阅中, 因此不允许对试用订阅使用客户密钥。</span><span class="sxs-lookup"><span data-stu-id="63cdd-286">Because Microsoft cannot and does not prevent customers from putting important customer data in trial subscriptions, the use of Customer Key with trial subscriptions is prohibited.</span></span>
  
## <a name="how-much-will-using-customer-key-cost"></a><span data-ttu-id="63cdd-287">使用客户密钥的成本有多大？</span><span class="sxs-lookup"><span data-stu-id="63cdd-287">How much will using Customer Key cost?</span></span>
<span data-ttu-id="63cdd-288"><a name="DiffCustomerKeyandBYOKAzureIP"> </a></span><span class="sxs-lookup"><span data-stu-id="63cdd-288"></span></span>

<span data-ttu-id="63cdd-289">除了客户密钥所需的许可, 客户将对密钥存储使用承担成本。</span><span class="sxs-lookup"><span data-stu-id="63cdd-289">In addition to the licensing required for Customer Key, customers will incur a cost for Key Vault usage.</span></span> <span data-ttu-id="63cdd-290">[Azure Key Vault 定价详细信息](https://azure.microsoft.com/en-us/pricing/details/key-vault/)介绍了成本模型, 并将协助估计。</span><span class="sxs-lookup"><span data-stu-id="63cdd-290">[Azure Key Vault pricing details](https://azure.microsoft.com/en-us/pricing/details/key-vault/) describes the cost model and will assist with estimating.</span></span> <span data-ttu-id="63cdd-291">由于使用模式不同, 因此无法预测任何客户将产生的确切成本。</span><span class="sxs-lookup"><span data-stu-id="63cdd-291">There is no way to predict the exact cost that any customer will incur because usage patterns vary.</span></span> <span data-ttu-id="63cdd-292">经验表明, 成本非常低, 并且通常在每个用户每月 $0.002 到 $0.005 的范围内, 再加上受 HSM 支持的密钥的成本。</span><span class="sxs-lookup"><span data-stu-id="63cdd-292">Experience has shown that the cost is very low and generally falls within the range of $0.002 to $0.005 per user per month plus the cost of HSM-backed keys.</span></span> <span data-ttu-id="63cdd-293">根据客户选择的日志记录配置和用于 azure Key Vault 日志的 azure 存储量, 该成本也会有所不同。</span><span class="sxs-lookup"><span data-stu-id="63cdd-293">The cost will also vary according to the logging configuration chosen by the customer and the amount of Azure storage used for Azure Key Vault logs.</span></span> 
  
## <a name="for-more-information"></a><span data-ttu-id="63cdd-294">有关详细信息</span><span class="sxs-lookup"><span data-stu-id="63cdd-294">For more information</span></span>
<span data-ttu-id="63cdd-295"><a name="DiffCustomerKeyandBYOKAzureIP"> </a></span><span class="sxs-lookup"><span data-stu-id="63cdd-295"></span></span>

<span data-ttu-id="63cdd-296">若要开始使用客户密钥, 请参阅[使用客户密钥控制 Office 365 中的数据](controlling-your-data-using-customer-key.md)。</span><span class="sxs-lookup"><span data-stu-id="63cdd-296">To get started with Customer Key, see [Controlling your data in Office 365 using Customer Key](controlling-your-data-using-customer-key.md).</span></span>
  

