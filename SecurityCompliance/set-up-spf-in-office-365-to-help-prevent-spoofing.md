---
title: 在 Office 365 中设置 SPF 以防止欺骗
ms.author: krowley
author: kccross
manager: laurawi
ms.date: 2/19/2018
ms.audience: ITPro
ms.topic: article
ms.service: O365-seccomp
ms.custom: TN2DMC
localization_priority: Normal
search.appverid:
- MET150
ms.assetid: 71373291-83d2-466f-86ea-fc61493743a6
description: 摘要：本文介绍了如何更新域名服务 (DNS) 记录，以便可以在 Office 365 中结合使用发件人策略框架 (SPF) 和自定义域。SPF 有助于验证从自定义域发送的出站电子邮件。
ms.openlocfilehash: 09adea835b793c638f50421a8f3970faefc5307e
ms.sourcegitcommit: 7e2a0185cadea7f3a6afc5ddc445eac2e1ce22eb
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 02/11/2019
ms.locfileid: "28326408"
---
# <a name="set-up-spf-in-office-365-to-help-prevent-spoofing"></a><span data-ttu-id="a438b-104">在 Office 365 中设置 SPF 以防止欺骗</span><span class="sxs-lookup"><span data-stu-id="a438b-104">Set up SPF in Office 365 to help prevent spoofing</span></span>

 <span data-ttu-id="a438b-p102">**摘要：** 本文介绍了如何更新域名服务 (DNS) 记录，以便可以在 Office 365 中结合使用发件人策略框架 (SPF) 和自定义域。SPF 有助于验证从自定义域发送的出站电子邮件。</span><span class="sxs-lookup"><span data-stu-id="a438b-p102">**Summary:** This article describes how to update a Domain Name Service (DNS) record so that you can use Sender Policy Framework (SPF) with your custom domain in Office 365. Using SPF helps to validate outbound email sent from your custom domain.</span></span> 
  
<span data-ttu-id="a438b-p103">若要使用自定义域，Office 365 要求你将发件人策略框架 (SPF) TXT 记录添加到 DNS 记录中，这样做有助于防止欺骗发生。SPF 标识允许哪些邮件服务器代表你发送邮件。一般来说，SPF 以及 DKIM、DMARC 和 Office 365 支持的其他技术可有助于防止欺骗和钓鱼发生。以 TXT 记录的形式添加 SPF 后，DNS 可使用此记录来确定哪些邮件服务器可以代表你的自定义域发送邮件。收件人邮件系统可以参阅 SPF TXT 记录，从而确定从你的自定义域发送的邮件是否来自已获授权的邮件服务器。</span><span class="sxs-lookup"><span data-stu-id="a438b-p103">In order to use a custom domain, Office 365 requires that you add a Sender Policy Framework (SPF) TXT record to your DNS record to help prevent spoofing. SPF identifies which mail servers are allowed to send mail on your behalf. Basically, SPF, along with DKIM, DMARC, and other technologies supported by Office 365 help prevent spoofing and phishing. SPF is added as a TXT record that is used by DNS to identify which mail servers can send mail on behalf of your custom domain. Recipient mail systems refer to the SPF TXT record to determine whether a message from your custom domain comes from an authorized messaging server.</span></span>
  
<span data-ttu-id="a438b-p104">例如，假设自定义域 contoso.com 使用 Office 365。你添加一个 SPF TXT 记录，将 Office 365 邮件服务器列为你的域的合法邮件服务器。当接收邮件服务器从 joe@contoso.com 收到一封邮件时，服务器会查找 contoso.com 的 SPF TXT 记录，并确定这封邮件是否有效。如果接收服务器确定这封邮件不是来自 SPF 记录中列出的 Office 365 邮件服务器，则可以选择将这封邮件作为垃圾邮件拒绝。</span><span class="sxs-lookup"><span data-stu-id="a438b-p104">For example, let's say that your custom domain contoso.com uses Office 365. You add an SPF TXT record that lists the Office 365 messaging servers as legitimate mail servers for your domain. When the receiving messaging server gets a message from joe@contoso.com, the server looks up the SPF TXT record for contoso.com and finds out whether the message is valid. If the receiving server finds out that the message comes from a server other than the Office 365 messaging servers listed in the SPF record, the receiving mail server can choose to reject the message as spam.</span></span>
  
<span data-ttu-id="a438b-p105">另外，如果自定义域没有 SPF TXT 记录，某些接收服务器可能会彻底拒绝邮件。这是因为接收服务器无法验证邮件是否来自已获授权的邮件服务器。</span><span class="sxs-lookup"><span data-stu-id="a438b-p105">Also, if your custom domain does not have an SPF TXT record, some receiving servers may reject the message outright. This is because the receiving server cannot validate that the message comes from an authorized messaging server.</span></span>
  
<span data-ttu-id="a438b-p106">如果你已经为 Office 365 设置了邮件，则表明已经将 Microsoft 的邮件服务器作为 SPF TXT 记录添加在 DNS 中。不过，在某些情况下，可能需要在 DNS 中更新 SPF TXT 记录。例如：</span><span class="sxs-lookup"><span data-stu-id="a438b-p106">If you've already set up mail for Office 365, then you have already included Microsoft's messaging servers in DNS as an SPF TXT record. However, there are some cases where you may need to update your SPF TXT record in DNS. For example:</span></span>
  
- <span data-ttu-id="a438b-p107">以前，如果要使用 SharePoint Online，必须向自定义域添加不同的 SPF TXT 记录。现在，不再需要这样做。此更改应该会降低 SharePoint Online 通知邮件最终被转入垃圾电子邮件文件夹的风险。如果即将达到查找限制 10 次，且看到“超出了查找限制”和“跃点过多”的错误消息，请更新 SPF TXT 记录。</span><span class="sxs-lookup"><span data-stu-id="a438b-p107">Previously, you had to add a different SPF TXT record to your custom domain if you were using SharePoint Online. This is no longer required. This change should reduce the risk of SharePoint Online notification messages ending up in the Junk Email folder. Update your SPF TXT record if you are hitting the 10 lookup limit and receiving errors that say things like, "exceeded the lookup limit" and "too many hops".</span></span>
    
- <span data-ttu-id="a438b-125">如果您拥有安装了 Office 365 和本地 Exchange 的混合环境。</span><span class="sxs-lookup"><span data-stu-id="a438b-125">If you have a hybrid environment with Office 365 and Exchange on-premises.</span></span>
    
- <span data-ttu-id="a438b-126">打算设置 DKIM 和 DMARC（推荐）。</span><span class="sxs-lookup"><span data-stu-id="a438b-126">You intend to set up DKIM and DMARC (recommended).</span></span>
    
## <a name="updating-your-spf-txt-record-for-office-365"></a><span data-ttu-id="a438b-127">为 Office 365 更新您的 SPF TXT 记录</span><span class="sxs-lookup"><span data-stu-id="a438b-127">Updating your SPF TXT record for Office 365</span></span>

<span data-ttu-id="a438b-p108">更新 DNS 中的 TXT 记录之前，需要收集一些信息，并确定记录的格式。这将有助于防止生成 DNS 错误。有关高级示例（更详细地介绍了支持的 SPF 语法），请参阅 [SPF 在 Office 365 中防止欺骗和钓鱼的工作原理](how-office-365-uses-spf-to-prevent-spoofing.md#HowSPFWorks)。</span><span class="sxs-lookup"><span data-stu-id="a438b-p108">Before you update the TXT record in DNS, you need to gather some information and determine the format of the record. This will help prevent you from generating DNS errors. For advanced examples, a more detailed discussion about supported SPF syntax, see [How SPF works to prevent spoofing and phishing in Office 365](how-office-365-uses-spf-to-prevent-spoofing.md#HowSPFWorks).</span></span>
  
<span data-ttu-id="a438b-131">收集此信息：</span><span class="sxs-lookup"><span data-stu-id="a438b-131">Gather this information:</span></span>
  
- <span data-ttu-id="a438b-p109">自定义域的当前 SPF TXT 记录。有关说明，请参阅[收集创建 Office 365 DNS 记录所需的信息](https://support.office.microsoft.com/en-us/article/Gather-the-information-you-need-to-create-Office-365-DNS-records-77f90d4a-dc7f-4f09-8972-c1b03ea85a67)。</span><span class="sxs-lookup"><span data-stu-id="a438b-p109">The current SPF TXT record for your custom domain. For instructions, see [Gather the information you need to create Office 365 DNS records](https://support.office.microsoft.com/en-us/article/Gather-the-information-you-need-to-create-Office-365-DNS-records-77f90d4a-dc7f-4f09-8972-c1b03ea85a67).</span></span>
    
- <span data-ttu-id="a438b-p110">所有本地邮件服务器的 IP 地址。例如， **192.168.0.1**。</span><span class="sxs-lookup"><span data-stu-id="a438b-p110">IP addresses of all on-premises messaging servers. For example, **192.168.0.1**.</span></span>
    
- <span data-ttu-id="a438b-p111">用于需要包含在 SPF TXT 记录中的所有第三方域的域名。一些批量邮件提供商已设置供其客户使用的子域。例如，MailChimp 公司已经设置了 **servers.mcsv.net**。</span><span class="sxs-lookup"><span data-stu-id="a438b-p111">Domain names to use for all third-party domains that you need to include in your SPF TXT record. Some bulk mail providers have set up subdomains to use for their customers. For example, the company MailChimp has set up **servers.mcsv.net**.</span></span>
    
- <span data-ttu-id="a438b-p112">确定要对 SPF TXT 记录使用的强制规则。我们建议使用 **-all**。有关其他语法选项的详细信息，请参阅 [Office 365 的 SPF TXT 记录语法](how-office-365-uses-spf-to-prevent-spoofing.md#SPFSyntaxO365)。</span><span class="sxs-lookup"><span data-stu-id="a438b-p112">Determine what enforcement rule you want to use for your SPF TXT record. We recommend **-all**. For detailed information about other syntax options, see [SPF TXT record syntax for Office 365](how-office-365-uses-spf-to-prevent-spoofing.md#SPFSyntaxO365).</span></span>
    
### <a name="to-add-or-update-your-spf-txt-record"></a><span data-ttu-id="a438b-142">添加或更新您的 SPF TXT 记录</span><span class="sxs-lookup"><span data-stu-id="a438b-142">To add or update your SPF TXT record</span></span>

1. <span data-ttu-id="a438b-143">如果尚未执行此操作，请通过使用下表中的语法构成 SPF TXT 记录：</span><span class="sxs-lookup"><span data-stu-id="a438b-143">If you have not already done so, form your SPF TXT record by using the syntax from the following table:</span></span>
    
||<span data-ttu-id="a438b-144">**如果您使用的是...**</span><span class="sxs-lookup"><span data-stu-id="a438b-144">**If you're using...**</span></span>|<span data-ttu-id="a438b-145">**对于 Office 365 客户很常见？**</span><span class="sxs-lookup"><span data-stu-id="a438b-145">**Common for Office 365 customers?**</span></span>|<span data-ttu-id="a438b-146">**添加以下内容...**</span><span class="sxs-lookup"><span data-stu-id="a438b-146">**Add this...**</span></span>|
|:-----|:-----|:-----|:-----|
|<span data-ttu-id="a438b-147">1</span><span class="sxs-lookup"><span data-stu-id="a438b-147">1</span></span>  <br/> |<span data-ttu-id="a438b-148">所有电子邮件系统（必需）</span><span class="sxs-lookup"><span data-stu-id="a438b-148">Any email system (required)</span></span>  <br/> |<span data-ttu-id="a438b-p113">常见。所有 SPF TXT 记录都以此值开头</span><span class="sxs-lookup"><span data-stu-id="a438b-p113">Common. All SPF TXT records start with this value</span></span>  <br/> |<span data-ttu-id="a438b-151">v=spf1</span><span class="sxs-lookup"><span data-stu-id="a438b-151">v=spf1</span></span>  <br/> |
|<span data-ttu-id="a438b-152">2 </span><span class="sxs-lookup"><span data-stu-id="a438b-152">2</span></span>  <br/> |<span data-ttu-id="a438b-153">Exchange Online</span><span class="sxs-lookup"><span data-stu-id="a438b-153">Exchange Online</span></span>  <br/> |<span data-ttu-id="a438b-154">常见</span><span class="sxs-lookup"><span data-stu-id="a438b-154">Common</span></span>  <br/> |<span data-ttu-id="a438b-155">include:spf.protection.outlook.com</span><span class="sxs-lookup"><span data-stu-id="a438b-155">include:spf.protection.outlook.com</span></span>  <br/> |
|<span data-ttu-id="a438b-156">3 </span><span class="sxs-lookup"><span data-stu-id="a438b-156">3</span></span>  <br/> |<span data-ttu-id="a438b-157">Exchange Online 专用</span><span class="sxs-lookup"><span data-stu-id="a438b-157">Exchange Online dedicated only</span></span>  <br/> |<span data-ttu-id="a438b-158">不常见</span><span class="sxs-lookup"><span data-stu-id="a438b-158">Not common</span></span>  <br/> |<span data-ttu-id="a438b-159">ip4:23.103.224.0/19 ip4:206.191.224.0/19 ip4:40.103.0.0/16 include:spf.protection.outlook.com</span><span class="sxs-lookup"><span data-stu-id="a438b-159">ip4:23.103.224.0/19 ip4:206.191.224.0/19 ip4:40.103.0.0/16 include:spf.protection.outlook.com</span></span>  <br/> |
|<span data-ttu-id="a438b-160">4 </span><span class="sxs-lookup"><span data-stu-id="a438b-160">4</span></span>  <br/> |<span data-ttu-id="a438b-161">仅 Office 365 Germany、Microsoft Cloud Germany</span><span class="sxs-lookup"><span data-stu-id="a438b-161">Office 365 Germany, Microsoft Cloud Germany only</span></span>  <br/> |<span data-ttu-id="a438b-162">不常见</span><span class="sxs-lookup"><span data-stu-id="a438b-162">Not common</span></span>  <br/> |<span data-ttu-id="a438b-163">include:spf.protection.outlook.de</span><span class="sxs-lookup"><span data-stu-id="a438b-163">include:spf.protection.outlook.de</span></span>  <br/> |
|<span data-ttu-id="a438b-164">5 </span><span class="sxs-lookup"><span data-stu-id="a438b-164">5</span></span>  <br/> |<span data-ttu-id="a438b-165">第三方电子邮件系统</span><span class="sxs-lookup"><span data-stu-id="a438b-165">Third-party email system</span></span>  <br/> |<span data-ttu-id="a438b-166">不常见</span><span class="sxs-lookup"><span data-stu-id="a438b-166">Not common</span></span>  <br/> |<span data-ttu-id="a438b-167">include:\<域名\></span><span class="sxs-lookup"><span data-stu-id="a438b-167">include:\<domain name\></span></span>  <br/> <span data-ttu-id="a438b-168">其中域名是第三方电子邮件系统的域名。</span><span class="sxs-lookup"><span data-stu-id="a438b-168">Where domain name is the domain name of the third party email system.</span></span>  <br/> |
|<span data-ttu-id="a438b-169">6 </span><span class="sxs-lookup"><span data-stu-id="a438b-169">6</span></span>  <br/> |<span data-ttu-id="a438b-p114">本地邮件系统。例如，Exchange Online Protection 和另一个邮件系统</span><span class="sxs-lookup"><span data-stu-id="a438b-p114">On-premises mail system. For example, Exchange Online Protection plus another mail system</span></span>  <br/> |<span data-ttu-id="a438b-172">不常见</span><span class="sxs-lookup"><span data-stu-id="a438b-172">Not common</span></span>  <br/> | <span data-ttu-id="a438b-173">为每个附加的邮件系统使用以下其中一个：</span><span class="sxs-lookup"><span data-stu-id="a438b-173">Use one of these for each additional mail system:</span></span>  <br/>  <span data-ttu-id="a438b-174">ip4:\<  _IP address_\></span><span class="sxs-lookup"><span data-stu-id="a438b-174">ip4:\<  _IP address_\></span></span>  <br/>  <span data-ttu-id="a438b-175">ip6:\<  _IP address_\></span><span class="sxs-lookup"><span data-stu-id="a438b-175">ip6:\<  _IP address_\></span></span>  <br/>  <span data-ttu-id="a438b-176">include:\<  _domain name_\></span><span class="sxs-lookup"><span data-stu-id="a438b-176">include:\<  _domain name_\></span></span>  <br/>  <span data-ttu-id="a438b-177">其中 \<  _IP address_\>的值是其他邮件系统的 IP 地址，\< _domain name_\> 是另一个代表您的域发送邮件的邮件系统的 IP 地址。</span><span class="sxs-lookup"><span data-stu-id="a438b-177">Where the value for \<  _IP address_\> is the IP address of the other mail system and \< _domain name_\> is the domain name of the other mail system that sends mail on behalf of your domain.</span></span>  <br/> |
|<span data-ttu-id="a438b-178">7 </span><span class="sxs-lookup"><span data-stu-id="a438b-178">7</span></span>  <br/> |<span data-ttu-id="a438b-179">所有电子邮件系统（必需）</span><span class="sxs-lookup"><span data-stu-id="a438b-179">Any email system (required)</span></span>  <br/> |<span data-ttu-id="a438b-p115">常见。所有 SPF TXT 记录都以此值结尾</span><span class="sxs-lookup"><span data-stu-id="a438b-p115">Common. All SPF TXT records end with this value</span></span>  <br/> |<span data-ttu-id="a438b-182">\< _enforcement rule_\></span><span class="sxs-lookup"><span data-stu-id="a438b-182">\< _enforcement rule_\></span></span>  <br/> <span data-ttu-id="a438b-p116">这可以是多个值之一。我们建议您使用 **-all**。  </span><span class="sxs-lookup"><span data-stu-id="a438b-p116">This can be one of several values. We recommend that you use **-all**.  </span></span><br/> |
   
<span data-ttu-id="a438b-185">1.1 例如，如果您是 Office 365 中完全承载，即，您具有没有内部部署邮件服务器，您的 SPF TXT 记录将包括行 1、 2 和 7 和将如下所示：</span><span class="sxs-lookup"><span data-stu-id="a438b-185">1.1  For example, if you are fully-hosted in Office 365, that is, you have no on-premises mail servers, your SPF TXT record would include rows 1, 2, and 7 and would look like this:</span></span>
    
  ```
   v=spf1 include:spf.protection.outlook.com -all
  ```

<span data-ttu-id="a438b-p117">1.2 这是最常见的 Office 365 SPF TXT 记录。此记录适用于几乎所有人，无论您的 Office 365 数据中心是否位于美国或欧洲 （包括德国），或者在其他位置。</span><span class="sxs-lookup"><span data-stu-id="a438b-p117">1.2  This is the most common Office 365 SPF TXT record. This record works for just about everyone, regardless of whether your Office 365 datacenter is located in the United States, or in Europe (including Germany), or in another location.</span></span>
    
<span data-ttu-id="a438b-p118">1.3 但是，如果您已购买 Office 365 德国，Microsoft 云德国的一部分您应使用 include 语句从第 4 行，而不是第 2 行。例如，如果您是完全承载在 Office 365 德国，即，必须没有内部部署邮件服务器，您的 SPF TXT 记录将包括行 1、 4 和 7 和将如下所示：</span><span class="sxs-lookup"><span data-stu-id="a438b-p118">1.3  However, if you have purchased Office 365 Germany, part of Microsoft Cloud Germany, you should use the include statement from line 4 instead of line 2. For example, if you are fully-hosted in Office 365 Germany, that is, you have no on-premises mail servers, your SPF TXT record would include rows 1, 4, and 7 and would look like this:</span></span>
    
  ```
   v=spf1 include:spf.protection.outlook.de -all
  ```

<span data-ttu-id="a438b-p119">1.4 如果您已部署 Office 365 中并已设置您的自定义域，SPF TXT 记录并将迁移到 Office 365 德国，您需要更新 SPF TXT 记录。若要执行此操作，更改到**include:spf.protection.outlook.de** **include:spf.protection.outlook.com** 。</span><span class="sxs-lookup"><span data-stu-id="a438b-p119">1.4  If you are already deployed in Office 365 and have set up your SPF TXT records for your custom domain, and you are migrating to Office 365 Germany, you need to update your SPF TXT record. To do this, change **include:spf.protection.outlook.com** to **include:spf.protection.outlook.de**.</span></span>
    
2. <span data-ttu-id="a438b-p120">一旦组成 SPF TXT 记录，您需要更新 DNS 中的记录。您只能有一个 SPF TXT 记录的域。如果存在 SPF TXT 记录，而不是添加新记录，您需要更新现有记录。转到[Office 365 创建 DNS 记录](https://docs.microsoft.com/office365/admin/get-help-with-domains/create-dns-records-at-any-dns-hosting-provider?view=o365-worldwide)，然后单击您的 DNS 主机的链接。</span><span class="sxs-lookup"><span data-stu-id="a438b-p120">Once you have formed your SPF TXT record, you need to update the record in DNS. You can only have one SPF TXT record for a domain. If an SPF TXT record exists, instead of adding a new record, you need to update the existing record. Go to [Create DNS records for Office 365](https://docs.microsoft.com/office365/admin/get-help-with-domains/create-dns-records-at-any-dns-hosting-provider?view=o365-worldwide), and then click the link for your DNS host.</span></span> 
    
3. <span data-ttu-id="a438b-196">测试您的 SPF TXT 记录。</span><span class="sxs-lookup"><span data-stu-id="a438b-196">Test your SPF TXT record.</span></span>
    
## <a name="more-information-about-spf"></a><span data-ttu-id="a438b-197">有关 SPF 的详细信息</span><span class="sxs-lookup"><span data-stu-id="a438b-197">More information about SPF</span></span>

<span data-ttu-id="a438b-198">有关支持的 SPF 语法、欺骗、故障排除以及 Office 365 如何支持 SPF 的更加详细的探讨的高级示例，请参阅 [SPF 在 Office 365 中防止欺骗和钓鱼的工作原理](how-office-365-uses-spf-to-prevent-spoofing.md#HowSPFWorks)。</span><span class="sxs-lookup"><span data-stu-id="a438b-198">For advanced examples, a more detailed discussion about supported SPF syntax, spoofing, troubleshooting, and how Office 365 supports SPF, see [How SPF works to prevent spoofing and phishing in Office 365](how-office-365-uses-spf-to-prevent-spoofing.md#HowSPFWorks).</span></span>
  
## <a name="next-steps-after-you-set-up-spf-for-office-365"></a><span data-ttu-id="a438b-199">后续步骤：为 Office 365 设置 SPF 之后</span><span class="sxs-lookup"><span data-stu-id="a438b-199">Next steps: After you set up SPF for Office 365</span></span>

<span data-ttu-id="a438b-p121">是否遇到与 SPF TXT 记录相关的问题？阅读[疑难解答：Office 365 中 SPF 的最佳实践。](how-office-365-uses-spf-to-prevent-spoofing.md#SPFTroubleshoot)。</span><span class="sxs-lookup"><span data-stu-id="a438b-p121">Having trouble with your SPF TXT record? Read [Troubleshooting: Best practices for SPF in Office 365](how-office-365-uses-spf-to-prevent-spoofing.md#SPFTroubleshoot).</span></span>
  
 <span data-ttu-id="a438b-p122">SPF 旨在帮助防止欺骗，但还有 SPF 无法防止的欺骗技术。为了防止这些欺骗，在你设置 SPF 后，也应该为 Office 365 配置 DKIM 和 DMARC。请参阅 [使用 DKIM 在 Office 365 中验证从自定义域发送的出站电子邮件](use-dkim-to-validate-outbound-email.md)，了解入门知识。之后，请参阅[使用 DMARC 验证 Office 365 中的电子邮件](use-dmarc-to-validate-email.md)。</span><span class="sxs-lookup"><span data-stu-id="a438b-p122">SPF is designed to help prevent spoofing, but there are spoofing techniques that SPF cannot protect against. In order to protect against these, once you have set up SPF, you should also configure DKIM and DMARC for Office 365. To get started, see [Use DKIM to validate outbound email sent from your custom domain in Office 365](use-dkim-to-validate-outbound-email.md). Next, see [Use DMARC to validate email in Office 365](use-dmarc-to-validate-email.md).</span></span>
  

